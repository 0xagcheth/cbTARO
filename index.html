<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>cbTARO - Mystical Taro Reading</title>
</head>
<body>
    <script>
      // Set dynamic viewport height for mobile WebView compatibility (iOS-safe)
      let rafId = null;
      function setVH() {
        if (rafId !== null) {
          cancelAnimationFrame(rafId);
        }
        rafId = requestAnimationFrame(() => {
          const vv = window.visualViewport;
          const h = vv ? vv.height : window.innerHeight;
          const vh = h * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
          rafId = null;
        });
      }
      setVH();
      window.addEventListener('resize', setVH);
      window.addEventListener('orientationchange', function() {
        setTimeout(setVH, 150);
      });
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', setVH);
        window.visualViewport.addEventListener('scroll', setVH);
      }

      // Universal asset path resolver - available globally
      (function() {
        const p=window.location.pathname || "";
        const seg=p.split("/").filter(Boolean)[0];
        window.APP_BASE = seg === "cbTARO" ? "/cbTARO" : "";
        
        // Unified ASSET function - always use format "Assets/..." (without public/)
        window.ASSET = function(path) {
          const cleanPath = path.replace(/^\/+/, '').replace(/^public\//, ''); // Remove leading slashes and "public/"
          // For GitHub Pages: /cbTARO/Assets/...
          // For local file: ./Assets/...
          if (window.APP_BASE) {
            return `${window.APP_BASE}/${cleanPath}`;
          }
          return `./${cleanPath}`;
        };

        // Set CSS variables for all asset paths (replaces inline CSS injection)
        // Set immediately - document.documentElement is available in <head>
        const root = document.documentElement;
        root.style.setProperty('--bg-url', `url("${window.ASSET("Assets/imagine/b.png")}")`);
        root.style.setProperty('--cardback-url', `url("${window.ASSET("Assets/imagine/bc.png")}")`);
      })();
    </script>

    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.26.2/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useRef, useEffect }=React;

      // Use global ASSET function (defined in script above)
      const ASSET = window.ASSET;
      const APP_BASE = window.APP_BASE;
      
      // Card image directory - use format without "public/"
      const CARD_IMG_DIR = "Assets/imagine/taro_cards";
      
      // Card filename corrections mapping (for actual file names on disk)
      const CARD_NAME_CORRECTIONS = {
        'THREE OF SWORDS': 'THREE OF SWARDS',
        'FIVE OF SWORDS': 'FIVE OF SWARDS'
      };
      
      const cardImagePath=(name) => {
        let fileName=name.toUpperCase();
        // Apply corrections if needed
        if (CARD_NAME_CORRECTIONS[fileName]) {
          fileName = CARD_NAME_CORRECTIONS[fileName];
        }
        return ASSET(`${CARD_IMG_DIR}/${fileName}.png`);
      };

      // Taro card data - all 78 cards
      const ALL_CARDS=[
        // Major Arcana
        { id: 0, name: "The Fool", keyword: "New Beginnings", description: "The Fool represents new beginnings, having faith in the future, being inexperienced, not knowing what to expect, having beginner's luck, improvisation and believing in the universe. Encourages take a leap of faith and embrace the unknown." },
        { id: 1, name: "The Magician", keyword: "Manifestation", description: "The Magician represents manifestation, resourcefulness, power, and inspired action. You have all the tools you need to make your dreams come true." },
        { id: 2, name: "The High Priestess", keyword: "Intuition", description: "The High Priestess represents intuition, sacred knowledge, and the subconscious mind. She encourages you to look within and trust your inner voice." },
        { id: 3, name: "The Empress", keyword: "Fertility", description: "The Empress represents fertility, nurturing, abundance, and Mother Nature. She embodies creativity, sensuality, and the power of creation." },
        { id: 4, name: "The Emperor", keyword: "Authority", description: "The Emperor represents authority, structure, control, and fatherhood. He embodies stability, power, and the ability to create order." },
        { id: 5, name: "The Hierophant", keyword: "Spiritual Wisdom", description: "The Hierophant represents tradition, conformity, morality, and ethics. He embodies spiritual wisdom, religious beliefs, and conformity." },
        { id: 6, name: "The Lovers", keyword: "Love", description: "The Lovers represent love, harmony, relationships, values alignment, and choices. Encourages make decisions based on your val." },
        { id: 7, name: "The Chariot", keyword: "Control", description: "The Chariot represents control, willpower, success, action, and determination. You have the drive and ambition to overcome obstacles and ac." },
        { id: 8, name: "Strength", keyword: "Strength", description: "Strength represents strength, courage, persuasion, influence, and compassion. True strength comes from inner calm and patience, not brute ." },
        { id: 9, name: "The Hermit", keyword: "Soul Searching", description: "The Hermit represents soul searching, introspection, being alone, and inner guidance. Encourages take time for reflection, seek a." },
        { id: 10, name: "Wheel of Fortune", keyword: "Good Luck", description: "The Wheel of Fortune represents good luck, karma, life cycles, and a turning point. Everything in life is cyclical, and change is constant." },
        { id: 11, name: "Justice", keyword: "Justice", description: "Justice represents justice, fairness, truth, cause and effect, and law. Every action has consequences, and balance will be restored." },
        { id: 12, name: "The Hanged Man", keyword: "Pause", description: "The Hanged Man represents pause, suspension, letting go, and new perspectives. Sometimes you need to stop and look at things from a differe." },
        { id: 13, name: "Death", keyword: "Endings", description: "Death represents endings, change, transformation, and transition. Signifies the end of a cycle and the beginning of ." },
        { id: 14, name: "Temperance", keyword: "Balance", description: "Temperance represents balance, moderation, patience, and purpose. Encourages find the middle path, blend oppo." },
        { id: 15, name: "The Devil", keyword: "Shadow Self", description: "The Devil represents addiction, materialism, playfulness, and bondage. This card reveals what holds you captiveâ€”whether it's unheal." },
        { id: 16, name: "The Tower", keyword: "Sudden Change", description: "The Tower represents sudden change, upheaval, chaos, revelation, and awakening. Signifies a dramatic shift that breaks down old st." },
        { id: 17, name: "The Star", keyword: "Hope", description: "The Star represents hope, faith, purpose, renewal, and spirituality. After the darkness of the Tower, the Star brings light and h." },
        { id: 18, name: "The Moon", keyword: "Illusion", description: "The Moon represents illusion, fear, anxiety, subconscious, and intuition. This card reveals hidden fears and anxieties that may be clo." },
        { id: 19, name: "The Sun", keyword: "Positivity", description: "The Sun represents positivity, fun, warmth, success, and vitality. This card brings joy, happiness, and success." },
        { id: 20, name: "Judgement", keyword: "Judgement", description: "Judgement represents judgement, rebirth, inner calling, and absolution. Signifies a time of reflection, evaluation, and aw." },
        { id: 21, name: "The World", keyword: "Completion", description: "The World represents completion, accomplishment, travel, and achievement. Signifies the successful completion of a journey o." },
        // Wands (Minor Arcana) - 22-35
        { id: 22, name: "Ace of Wands", keyword: "Inspiration", description: "The Ace of Wands represents inspiration, spiritual enlightenment, new opportunities, and new projects. This card brings a burst of creative energy and enthusiasm." },
        { id: 23, name: "Two of Wands", keyword: "Planning", description: "The Two of Wands represents planning, progress, discovery, and making decisions. Signifies the beginning of a journey and the coura." },
        { id: 24, name: "Three of Wands", keyword: "Expansion", description: "The Three of Wands represents expansion, foresight, overseas opportunities, and looking ahead. Signifies growth, progress, and the rewards of you." },
        { id: 25, name: "Four of Wands", keyword: "Celebration", description: "The Four of Wands represents celebration, joy, harmony, and homecoming. Signifies a time of happiness, stability, and comm." },
        { id: 26, name: "Five of Wands", keyword: "Conflict", description: "The Five of Wands represents conflict, disagreements, competition, and tension. Signifies challenges and obstacles that require ef." },
        { id: 27, name: "Six of Wands", keyword: "Success", description: "The Six of Wands represents success, public recognition, progress, and self-confidence. Signifies achievement, victory, and the recognitio." },
        { id: 28, name: "Seven of Wands", keyword: "Challenge", description: "The Seven of Wands represents challenge, competition, perseverance, and defense. Signifies standing your ground and defending what ." },
        { id: 29, name: "Eight of Wands", keyword: "Speed", description: "The Eight of Wands represents speed, action, alignment, and air travel. Signifies rapid progress, momentum, and things mov." },
        { id: 30, name: "Nine of Wands", keyword: "Resilience", description: "The Nine of Wands represents resilience, courage, persistence, and grit. Signifies inner strength and the ability to keep g." },
        { id: 31, name: "Ten of Wands", keyword: "Burden", description: "The Ten of Wands represents burden, extra responsibility, hard work, and doing it all. Signifies feeling overwhelmed by responsibilities ." },
        { id: 32, name: "Page of Wands", keyword: "Inspiration", description: "The Page of Wands represents inspiration, ideas, discovery, and limitless potential. Signifies enthusiasm, curiosity, and the spark of ." },
        { id: 33, name: "Knight of Wands", keyword: "Adventure", description: "The Knight of Wands represents adventure, passion, impulsiveness, and enthusiasm. Signifies energy, action, and the pursuit of goals." },
        { id: 34, name: "Queen of Wands", keyword: "Courage", description: "The Queen of Wands represents courage, determination, joy, and radiance. This card embodies confidence, charisma, and creative fire." },
        { id: 35, name: "King of Wands", keyword: "Leadership", description: "The King of Wands represents leadership, vision, entrepreneurship, and honor. Signifies natural-born leadership and the ability ." },
        // Cups (Minor Arcana) - 36-49
        { id: 36, name: "Ace of Cups", keyword: "Love", description: "The Ace of Cups represents love, new relationships, compassion, and creativity. Signifies emotional fulfillment, new beginnings in." },
        { id: 37, name: "Two of Cups", keyword: "Unified Love", description: "The Two of Cups represents unified love, partnership, mutual attraction, and relationships. Signifies a deep connection, partnership, or roman." },
        { id: 38, name: "Three of Cups", keyword: "Celebration", description: "The Three of Cups represents celebration, friendship, creativity, and community. Signifies joy, abundance, and the celebration of l." },
        { id: 39, name: "Four of Cups", keyword: "Meditation", description: "The Four of Cups represents meditation, contemplation, apathy, and reevaluation. Signifies feeling disconnected or disillusioned, b." },
        { id: 40, name: "Five of Cups", keyword: "Regret", description: "The Five of Cups represents regret, failure, disappointment, and pessimism. This card acknowledges loss and grief, but reminds you that ." },
        { id: 41, name: "Six of Cups", keyword: "Revisiting", description: "The Six of Cups represents revisiting the past, childhood memories, innocence, and joy. Signifies nostalgia, simplicity, and the pleasure ." },
        { id: 42, name: "Seven of Cups", keyword: "Opportunity", description: "The Seven of Cups represents opportunity, choice, wishful thinking, and illusion. Signifies having many options and possibilities, b." },
        { id: 43, name: "Eight of Cups", keyword: "Disappointment", description: "The Eight of Cups represents disappointment, abandonment, withdrawal, and escapism. Signifies leaving behind what no longer serves you." },
        { id: 44, name: "Nine of Cups", keyword: "Contentment", description: "The Nine of Cups represents contentment, satisfaction, gratitude, and wish fulfillment. Signifies emotional satisfaction, happiness, and t." },
        { id: 45, name: "Ten of Cups", keyword: "Divine Love", description: "The Ten of Cups represents divine love, blissful relationships, harmony, and alignment. Signifies happiness, emotional fulfillment, and ha." },
        { id: 46, name: "Page of Cups", keyword: "Creative Opportunities", description: "The Page of Cups represents creative opportunities, intuitive messages, curiosity, and possibility. Signifies new emotional experiences and intuitive ." },
        { id: 47, name: "Knight of Cups", keyword: "Creativity", description: "The Knight of Cups represents creativity, romance, bringing or receiving a message, and imagination. Signifies emotional expression, artistic pursuits,." },
        { id: 48, name: "Queen of Cups", keyword: "Compassionate", description: "The Queen of Cups represents compassionate, caring, emotionally stable, and intuitive. Signifies emotional intelligence, empathy, and nur." },
        { id: 49, name: "King of Cups", keyword: "Emotionally Balanced", description: "The King of Cups represents emotionally balanced, compassionate, diplomatic, and wise. Signifies emotional maturity, compassion, and the ." },
        // Swords (Minor Arcana) - 50-63
        { id: 50, name: "Ace of Swords", keyword: "Breakthroughs", description: "The Ace of Swords represents breakthroughs, new ideas, mental clarity, and success. Signifies mental clarity, sharp thinking, and the ." },
        { id: 51, name: "Two of Swords", keyword: "Difficult Decisions", description: "The Two of Swords represents difficult decisions, weighing up options, and inner conflict. Signifies being at a crossroads and needing to mak." },
        { id: 52, name: "Three of Swords", keyword: "Heartbreak", description: "The Three of Swords represents heartbreak, emotional pain, sorrow, grief, and hurt. This card acknowledges difficult emotions and painful experi." },
        { id: 53, name: "Four of Swords", keyword: "Rest", description: "The Four of Swords represents rest, relaxation, meditation, and contemplation. Signifies the need for a break and time to recharg." },
        { id: 54, name: "Five of Swords", keyword: "Conflict", description: "The Five of Swords represents conflict, disagreements, competition, and defeat. Signifies arguments, tension, and the need to choo." },
        { id: 55, name: "Six of Swords", keyword: "Transition", description: "The Six of Swords represents transition, change, rite of passage, and releasing baggage. Signifies moving from difficult times to calmer wa." },
        { id: 56, name: "Seven of Swords", keyword: "Betrayal", description: "The Seven of Swords represents betrayal, deception, getting away with something, and stealth. Signifies dishonesty, manipulation, or avoiding re." },
        { id: 57, name: "Eight of Swords", keyword: "Negative Thoughts", description: "The Eight of Swords represents negative thoughts, self-imposed restriction, and inner critic. Signifies feeling trapped by your own thoughts and." },
        { id: 58, name: "Nine of Swords", keyword: "Anxiety", description: "The Nine of Swords represents anxiety, worry, fear, depression, and nightmares. Signifies mental anguish and the torment of negati." },
        { id: 59, name: "Ten of Swords", keyword: "Painful Endings", description: "The Ten of Swords represents painful endings, deep wounds, betrayal, and loss. Signifies rock bottom and the need for transformat." },
        { id: 60, name: "Page of Swords", keyword: "New Ideas", description: "The Page of Swords represents new ideas, curiosity, thirst for knowledge, and new ways of communicating. Signifies mental agility and the excitement of lea." },
        { id: 61, name: "Knight of Swords", keyword: "Action", description: "The Knight of Swords represents action, impulsiveness, defending beliefs, and fighting for what you believe in. Encourages take decisive action, speak your." },
        { id: 62, name: "Queen of Swords", keyword: "Independence", description: "The Queen of Swords represents independence, unbiased judgement, clear boundaries, and direct communication. Signifies mental clarity, honesty, and the ability." },
        { id: 63, name: "King of Swords", keyword: "Mental Clarity", description: "The King of Swords represents mental clarity, intellectual power, authority, and truth. Signifies logical thinking, fairness, and the abil." },
        // Pentacles (Minor Arcana) - 64-77
        { id: 64, name: "Ace of Pentacles", keyword: "Manifestation", description: "The Ace of Pentacles represents manifestation, new financial opportunity, and abundance. Signifies material success, financial stability, a." },
        { id: 65, name: "Two of Pentacles", keyword: "Balance", description: "The Two of Pentacles represents balance, priorities, and multitasking. Signifies juggling multiple responsibilities and f." },
        { id: 66, name: "Three of Pentacles", keyword: "Collaboration", description: "The Three of Pentacles represents collaboration, learning, and implementation. Signifies teamwork, craftsmanship, and the rewards." },
        { id: 67, name: "Four of Pentacles", keyword: "Control", description: "The Four of Pentacles represents control, stability, security, and possession. This card suggests holding tightly to what you have, but war." },
        { id: 68, name: "Five of Pentacles", keyword: "Financial Loss", description: "The Five of Pentacles represents financial loss, poverty, lack mindset, and isolation. Signifies hardship and the feeling of being left o." },
        { id: 69, name: "Six of Pentacles", keyword: "Giving", description: "The Six of Pentacles represents giving, receiving, sharing wealth, and generosity. Signifies charity, fairness, and the balance betwe." },
        { id: 70, name: "Seven of Pentacles", keyword: "Perseverance", description: "The Seven of Pentacles represents perseverance, investment, effort, and reward. Signifies patience and the need to wait for result." },
        { id: 71, name: "Eight of Pentacles", keyword: "Apprenticeship", description: "The Eight of Pentacles represents apprenticeship, repetitive tasks, mastery, and skill development. Signifies dedication to your craft and the process." },
        { id: 72, name: "Nine of Pentacles", keyword: "Abundance", description: "The Nine of Pentacles represents abundance, luxury, self-sufficiency, and financial independence. Signifies material comfort, refinement, and the re." },
        { id: 73, name: "Ten of Pentacles", keyword: "Wealth", description: "The Ten of Pentacles represents wealth, financial security, family, and long-term success. Signifies abundance, legacy, and the completion of." },
        { id: 74, name: "Page of Pentacles", keyword: "Financial Opportunity", description: "The Page of Pentacles represents financial opportunity, skill development, and new ideas. Signifies practical learning and the beginning of ." },
        { id: 75, name: "Knight of Pentacles", keyword: "Hard Work", description: "The Knight of Pentacles represents hard work, productivity, and routine. Signifies diligence, responsibility, and the rewar." },
        { id: 76, name: "Queen of Pentacles", keyword: "Nurturing", description: "The Queen of Pentacles represents nurturing, practical, providing financially, and a healthy home. Signifies abundance, generosity, and caring for ot." },
        { id: 77, name: "King of Pentacles", keyword: "Abundance", description: "The King of Pentacles represents abundance, prosperity, security, and financial security. Signifies material success, stability, and practic." }
      ];

      function getRandomCards(count){
        const arr=[...ALL_CARDS];
        for(let i=arr.length-1;i>0;i--){
          const j=Math.floor(Math.random()*(i+1));
          [arr[i],arr[j]]=[arr[j],arr[i]];
        }
        return arr.slice(0,count);
      }

      function TaroApp() {
        const [gameStage, setGameStage]=useState("idle");
        const [selectedSpread, setSelectedSpread]=useState(null);
        const [cards, setCards]=useState([]);
        const [revealedIds, setRevealedIds]=useState([]);
        const [activeCard, setActiveCard]=useState(null);
        const [isLoading, setIsLoading]=useState(false);
        const [userQuestion, setUserQuestion]=useState("");
        const [aiInterpretation, setAiInterpretation]=useState(null);
        const [isGeneratingAI, setIsGeneratingAI]=useState(false);
        const [showAiPanel, setShowAiPanel]=useState(false);
        const [showGallery, setShowGallery]=useState(false);
        const [previousGameStage, setPreviousGameStage]=useState("idle");
        const [readingSource, setReadingSource]=useState(null);
        const [soundEnabled, setSoundEnabled]=useState(true);
        const [brokenImages, setBrokenImages]=useState({});
        const animTimerRef=useRef(null);
        const abortControllerRef=useRef(null);
        const audioCacheRef=useRef(new Map());

        useEffect(() => {
          return () => {
            if(animTimerRef.current) clearTimeout(animTimerRef.current);
            if(abortControllerRef.current) abortControllerRef.current.abort();
            audioCacheRef.current.forEach((a) => { try { a.pause(); } catch {} });
            audioCacheRef.current.clear();
          };
        }, []);

        // Block body scroll when overlays/modals are open
        useEffect(() => {
          const hasOverlay = showGallery || activeCard || (aiInterpretation && showAiPanel);
          if (hasOverlay) {
            document.body.style.overflow = 'hidden';
          } else {
            document.body.style.overflow = '';
          }
          return () => {
            document.body.style.overflow = '';
          };
        }, [showGallery, activeCard, aiInterpretation, showAiPanel]);

        const playSound=(path,vol=0.3) => {
          if(!soundEnabled)return;
          const audioPath=ASSET(path);
          try {
            let a=audioCacheRef.current.get(audioPath);
            if(!a) {
              a=new Audio(audioPath);
              a.preload="auto";
              audioCacheRef.current.set(audioPath, a);
            }
            a.pause();
            a.currentTime=0;
            a.volume=vol;
            const p=a.play();
            if(p && typeof p.catch === "function") {
              p.catch((err) => console.warn("Audio play blocked:", audioPath, err));
            }
          } catch(err) {
            console.warn("Audio init failed:", audioPath, err);
          }
        };
        const playButtonSound=() => playSound('Assets/audio/tab.mp3',0.3);
        const playSpreadSound=() => playSound('Assets/audio/spread.mp3',0.4);

        const withClick=(fn, stop=true) => (e) => {
          if (stop && e?.stopPropagation) e.stopPropagation();
          playButtonSound();
          fn && fn(e);
        };

        const sanitizeHTML=(text) => {
          if(!text || typeof text!=='string') return '';
          const div=document.createElement('div');
          div.textContent=text;
          let html=div.innerHTML.replace(/\n/g,'<br/>');
          html=html.replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>');
          html=html.replace(/ðŸŒŸ\s*\*\*([^*]+)\*\*/g,'<strong class="taro-ai-section-title">$1</strong>');
          html=html.replace(/âš¡\s*\*\*([^*]+)\*\*/g,'<strong class="taro-ai-section-title">$1</strong>');
          html=html.replace(/ðŸ”®\s*\*\*([^*]+)\*\*/g,'<strong class="taro-ai-section-title">$1</strong>');
          html=html.replace(/âœ¨\s*\*\*([^*]+)\*\*/g,'<strong class="taro-ai-section-title">$1</strong>');
          html=html.replace(/[ðŸŒŸâš¡ðŸ”®âœ¨]/g,'');
          return html;
        };

        const getAIInterpretation=async (cards, question) => {
          if(!cards || cards.length===0 || !question || typeof question!=='string' || question.length < 3 || question.length > 500) {
            return generateFallbackInterpretation(cards, question || '');
          }

          if(abortControllerRef.current) abortControllerRef.current.abort();
          const controller=new AbortController();
          abortControllerRef.current=controller;
          const kill=setTimeout(() => controller.abort(), 15000);

          try {
            const safeQ=question.replace(/[\u0000-\u001F\u007F]/g, " ").slice(0, 500);
            const prompt=`You are a master taro reader who creates deeply personalized, spiritually resonant interpretations based on the unique energies of each card combination.

CRITICAL: Respond ONLY in English, regardless of the question's language. Always provide the reading in English.

The seeker asked: "${safeQ}"

Here are the specific cards drawn in this unique reading:

${cards.map((c, i) =>
  `Position ${i + 1}: ${c?.positionLabel || 'position'}
Card: ${c?.name || 'Card'} (Keyword: ${c?.keyword || 'guidance'})
Meaning: ${c?.description || 'This card brings its unique energy'}`).join("\n\n")}

Now, create a bespoke interpretation that weaves these specific card energies together. Analyze how these particular cards interact and what their unique combination reveals about the seeker's situation.

Focus deeply on:
- The specific symbolism and energies of each individual card
- How these cards relate to each other in this spread
- The unique message this card combination creates for this question
- The spiritual wisdom this particular set of cards brings

Structure your mystical guidance:

ðŸŒŸ **Divine Message from the Cards** - Interpret the unique energies and symbolism of this specific card combination
âš¡ **Sacred Actions to Consider** - Practical spiritual steps based on these particular cards' guidance
ðŸ”® **Mystic Awareness** - Important insights and potential challenges revealed by this card spread
âœ¨ **Soul's Journey** - The deeper spiritual meaning and hope this reading brings

Make this reading feel like it was crafted specifically for this seeker with this exact card combination. Reference the specific cards by name and connect their meanings in meaningful ways. Avoid generic advice - be specific to these cards' energies and symbolism.

Important: This must be a unique interpretation for this specific card spread. Make it feel personal, spiritually deep, and directly connected to these particular cards. Always respond in English.`;

            const response=await fetch(
              "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  inputs: prompt,
                  parameters: { max_new_tokens: 300, temperature: 0.7, return_full_text: false }
                }),
                signal: controller.signal
              }
            );

            if (!response.ok) {
              return generateFallbackInterpretation(cards, question);
            }

            const data=await response.json();
            const text=Array.isArray(data) ? (data[0]?.generated_text || "") : (typeof data?.generated_text === "string" ? data.generated_text : "");
            return (text || "").slice(0, 2000) || generateFallbackInterpretation(cards, question);
          } catch (error) {
            if(error.name === 'AbortError') return generateFallbackInterpretation(cards, question);
            console.error("AI API error:", error);
            return generateFallbackInterpretation(cards, question);
          } finally {
            clearTimeout(kill);
            if(abortControllerRef.current === controller) abortControllerRef.current=null;
          }
        };

        const generateFallbackInterpretation=(cards, question) => {
          if(!Array.isArray(cards) || cards.length===0) return 'No cards available.';
          const safeQuestion=String(question || '').slice(0,200).replace(/"/g,'\\"');
          const cardNames=cards.map(c => c?.name).filter(Boolean).join(", ");
          const themes=cards.map(c => c?.keyword).filter(Boolean).join(", ");
          const cardDetails=cards.map((c, i) => {
            const name=c?.name || `Card ${i + 1}`;
            const pos=c?.positionLabel || 'position';
            const kw=(c?.keyword || 'guidance').toLowerCase();
            return `${name} in the ${pos} position brings ${kw} energy`;
          }).join(". ");
          const c0=cards[0];
          const c1=cards[1];
          const c2=cards[2];
          const actionLine=c1 ? `The ${c1.name} suggests deepening your intuitive connection` : `Let this card guide your intuition`;
          const actionLine2=c2 ? `while ${c2.name} guides you toward authentic action that honors your soul's purpose` : `and move with calm confidence`;
          const awarenessLine=c1 ? `Pay special attention to the ${c1.name}'s message about balance and harmony.` : `Pay special attention to subtle signs and timing.`;

          return `ðŸŒŸ **Divine Message from the Cards:** The sacred combination of ${cardNames} creates a unique spiritual tapestry for your question "${safeQuestion}". ${cardDetails}. This rare alignment speaks of transformation and divine timing.

âš¡ **Sacred Actions to Consider:** Drawing from the specific wisdom of ${c0?.name || 'this card'}'s ${(c0?.keyword || 'guidance').toLowerCase()} energy, consider embracing new perspectives. ${actionLine}, ${actionLine2}.

ðŸ”® **Mystic Awareness:** ${awarenessLine} This warns against forcing outcomes - trust the natural flow revealed by this arrangement.

âœ¨ **Soul's Journey:** This spread carries the blessing of ${themes || 'insight'}. Trust that this specific combination appeared for your highest good.`;
        };

        const handleSelectSpread=async (spread) => {
          setSelectedSpread(spread);
          setAiInterpretation(null);
          setShowAiPanel(false);

          if (spread === "ONE" || spread === "THREE" || spread === "CUSTOM") {
            await startSpreadAnimation(spread);
          }
        };

        const startSpreadAnimation=async (spread) => {
          setIsLoading(true);
          if(animTimerRef.current) clearTimeout(animTimerRef.current);

          try {
            await new Promise((resolve) => setTimeout(resolve, 300));
            playSpreadSound();
            setGameStage("animating");

            animTimerRef.current=setTimeout(() => {
              const count=spread === "ONE" ? 1 : 3;
              const newCards=getRandomCards(count);
              if(!newCards || newCards.length===0) {
                setGameStage("idle");
                setIsLoading(false);
                return;
              }

              if (spread === "THREE") {
                const labeled=newCards.map((card, idx) => ({
                  ...card,
                  positionLabel: idx === 0 ? "Today's Energy" : idx === 1 ? "Support" : "Challenge",
                }));
                setCards(labeled);
              } else if (spread === "CUSTOM") {
                const labeled=newCards.map((card, idx) => ({
                  ...card,
                  positionLabel: idx === 0 ? "Past/Foundation" : idx === 1 ? "Present/Situation" : "Future/Guidance",
                }));
                setCards(labeled);
              } else {
                setCards(newCards);
              }

              setRevealedIds([]);
              setActiveCard(null);
              setGameStage("spread");
              setIsLoading(false);
            }, 1200);
          } catch (err) {
            console.error("Error:", err);
            setIsLoading(false);
            setGameStage(spread === "CUSTOM" ? "custom" : "idle");
          }
        };

        const generateCustomInterpretation=async (revealedIdsArray) => {
          if (!Array.isArray(revealedIdsArray)) revealedIdsArray = revealedIds || [];
          if (!Array.isArray(cards) || cards.length === 0) {
            console.warn('generateCustomInterpretation: no cards available');
            return;
          }
          const allRevealed = cards.length > 0 && cards.every((c) => revealedIdsArray.includes(c.id));
          const question = (userQuestion || '').trim().substring(0, 500);
          if (selectedSpread === "CUSTOM" && allRevealed && !aiInterpretation && question && question.length >= 3) {
            setIsGeneratingAI(true);
            try {
              const interpretation = await getAIInterpretation(cards, question);
              setAiInterpretation(interpretation || '');
              setShowAiPanel(true);
            } catch (error) {
              console.error('AI interpretation failed:', error);
              setAiInterpretation(generateFallbackInterpretation(cards, question));
              setShowAiPanel(true);
            } finally {
              setIsGeneratingAI(false);
            }
          } else {
            console.log('generateCustomInterpretation conditions not met:', {
              selectedSpread,
              allRevealed,
              hasInterpretation: !!aiInterpretation,
              question: question ? `${question.substring(0, 20)}...` : 'empty',
              questionLength: question.length,
              cardsCount: cards.length,
              revealedCount: revealedIdsArray.length
            });
          }
        };

        const handleCardClick=(card) => {
          playButtonSound();
          setReadingSource('spread');

          if (revealedIds.includes(card.id)) {
            setActiveCard(card);
            setGameStage("reading");
            return;
          }

          setRevealedIds((prev) => {
            const newRevealedIds=[...prev, card.id];
            const question=(userQuestion || '').trim();
            // Only auto-generate if all cards are revealed AND question exists
            if (selectedSpread === "CUSTOM" && Array.isArray(cards) && cards.length > 0 && newRevealedIds.length === cards.length && question && question.length>=3) {
              setTimeout(() => {
                generateCustomInterpretation(newRevealedIds);
              }, 1000);
            }
            return newRevealedIds;
          });
          setActiveCard(card);
          setGameStage("reading");
        };

        const handleCloseReading=() => {
          const source=readingSource;
          setReadingSource(null);
          setActiveCard(null);
          if(source!=='gallery' && cards.length>0) {
            setGameStage("spread");
          }
        };

        const handleNewSpread=() => {
          setGameStage("idle");
          setSelectedSpread(null);
          setCards([]);
          setRevealedIds([]);
          setActiveCard(null);
          setUserQuestion("");
          setAiInterpretation(null);
          setShowAiPanel(false);
        };

        const handleChooseSpreadClick=() => {
          playButtonSound();
          setGameStage("choosing");
        };

        const isAllRevealed = Array.isArray(cards) && cards.length > 0 && Array.isArray(revealedIds) && cards.every((c) => c && c.id !== undefined && revealedIds.includes(c.id));

        return (
          <div className="taro-root">
            <div className="taro-background" />

            <div className="control-buttons-left">
              <button
                className="sound-toggle-btn sound-toggle-btn-left"
                onClick={(e) => {
                  e.stopPropagation();
                  if (soundEnabled) playButtonSound();
                  setSoundEnabled(!soundEnabled);
                }}
                title={soundEnabled ? "Disable sound" : "Enable sound"}
              >
                {soundEnabled ? "ðŸ”Š" : "ðŸ”‡"}
              </button>
            </div>

            <div className="taro-container">
              <header className="taro-header">
                <h1>cbTaro</h1>
              </header>

              <main className="taro-main">
                <div className="control-buttons">
                  <button
                    className="gallery-button"
                    onClick={withClick((e) => {
                      setPreviousGameStage(gameStage);
                      setShowGallery(true);
                    })}
                    title="View all taro cards"
                  >
                    â˜°
                  </button>
                </div>

                <div className="taro-table-wrap">
                  <div className={`taro-table ${gameStage === "animating" ? "table-animating" : ""}`}>
                    <div className="taro-table-content">
                      {gameStage === "idle" && (
                        <div className="taro-deck" onClick={handleChooseSpreadClick}>
                          <div className="taro-deck-inner" />
                        </div>
                      )}

                      {(gameStage === "spread" || gameStage === "reading") && (
                        <div className="taro-spread">
                          {cards.map((card, index) => {
                            const isRevealed=revealedIds.includes(card.id);
                            const spreadType=selectedSpread;
                            const offsetClass=spreadType === "THREE"
                                ? index === 0
                                  ? "card-left"
                                  : index === 1
                                  ? "card-center"
                                  : "card-right"
                                : "card-single";

                            return (
                              <div key={card.id} className={`card-slot ${offsetClass}`}>
                                <div
                                  className={`card-anim ${isRevealed ? "card-revealed" : ""}`}
                                  onClick={() => handleCardClick(card)}
                                  onAnimationEnd={(e) => {
                                    const animEl=e.currentTarget;
                                    const finalRot=offsetClass === 'card-left' ? -15 : offsetClass === 'card-right' ? 15 : 0;
                                    animEl.style.transform=`translate3d(0, 0, 0) rotate(${finalRot}deg) scale(1)`;
                                    animEl.style.opacity='1';
                                  }}
                                >
                                  <div className="taro-card-inner">
                                    <div className="taro-card-back"></div>
                                    <div className="taro-card-front">
                                      {!brokenImages[card.id] ? (
                                        <img
                                          src={cardImagePath(card.name)}
                                          alt={card.name}
                                          className="taro-card-image"
                                          onError={(e) => {
                                            console.warn('Card image failed to load:', card.name, e.target.src);
                                            setBrokenImages(m => ({...m, [card.id]: true}));
                                          }} />
                                      ) : (
                                        <div className="taro-card-fallback">
                                          <div className="taro-card-name">{card.name}</div>
                                          <div className="taro-card-keyword">{card.keyword}</div>
                                        </div>
                                      )}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}

                      {gameStage === "custom" && (
                        <div className="taro-modal custom-reading-modal">
                          <div className="custom-modal-content">
                            <div className="custom-modal-prompt">âœ§ What would you like to know? âœ§</div>
                            <textarea
                              className="custom-modal-input"
                              placeholder="Enter your question here..."
                              value={userQuestion}
                              onChange={(e) => {
                                const val=e.target.value.substring(0,500);
                                setUserQuestion(val);
                              }}
                              rows={4}
                              maxLength={500}
                              disabled={isLoading} />
                            <div className="custom-modal-actions">
                              <button
                                className="custom-modal-btn secondary"
                                onClick={() => {
                                  setGameStage("choosing");
                                  setUserQuestion("");
                                }}
                                disabled={isLoading}
                              >
                                &lt;
                              </button>
                              <button
                                className="custom-modal-btn primary"
                                onClick={() => {
                                  const question = (userQuestion || '').trim();
                                  if (!question || question.length < 3) {
                                    alert('Please enter your question first (at least 3 characters).');
                                    return;
                                  }
                                  handleSelectSpread("CUSTOM");
                                }}
                                disabled={isLoading || !userQuestion || !userQuestion.trim() || userQuestion.trim().length < 3}
                              >
                                {isLoading ? "Reading..." : "âœ¨"}
                              </button>
                            </div>
                          </div>
                        </div>
                      )}

                      {gameStage === "choosing" && (
                        <div
                          className="taro-modal choosing-modal"
                          onClick={(e) => {
                            const clickedElement=e.target;
                            const isContentClick=clickedElement.closest('.spread-option') ||
                                                  clickedElement.closest('.modal-bottom-buttons') ||
                                                  clickedElement.closest('.custom-reading-overlay-button');

                            if (!isContentClick) {
                              playButtonSound();
                              setGameStage("idle");
                            }
                          }}
                        >
                          <div
                            className="spread-selection"
                            onClick={(e) => {
                              if (e.target === e.currentTarget || !e.target.closest('.spread-option')) {
                                playButtonSound();
                                setGameStage("idle");
                              }
                            }}
                          >
                            <div
                              className="spread-option single-card-option"
                              onClick={withClick((e) => {
                                if (!isLoading) {
                                  handleSelectSpread("ONE");
                                }
                              })}
                              style={{ opacity: isLoading ? 0.5 : 1, cursor: isLoading ? 'not-allowed' : 'pointer' }}
                            >
                              <div className="spread-preview">
                                <div className="preview-card single-preview-card">
                                  <div className="preview-card-inner">
                                    <div className="preview-card-back"></div>
                                    <div className="preview-card-front">
                                      <img
                                        src={cardImagePath("The Fool")}
                                        alt="Single Card"
                                        className="preview-card-image"
                                        onError={(e) => {
                                          e.target.src=cardImagePath("The Magician");
                                        }} />
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div
                              className="spread-option three-cards-option"
                              onClick={withClick((e) => {
                                if (!isLoading) {
                                  handleSelectSpread("THREE");
                                }
                              })}
                              style={{ opacity: isLoading ? 0.5 : 1, cursor: isLoading ? 'not-allowed' : 'pointer' }}
                            >
                              <div className="spread-preview">
                                <div className="preview-card three-preview-card left-card">
                                  <div className="preview-card-inner">
                                    <div className="preview-card-back"></div>
                                    <div className="preview-card-front">
                                      <img
                                        src={cardImagePath("The Fool")}
                                        alt="Three Cards"
                                        className="preview-card-image"
                                      />
                                    </div>
                                  </div>
                                </div>
                                <div className="preview-card three-preview-card center-card">
                                  <div className="preview-card-inner">
                                    <div className="preview-card-back"></div>
                                    <div className="preview-card-front">
                                      <img
                                        src={cardImagePath("The Magician")}
                                        alt="Three Cards"
                                        className="preview-card-image"
                                      />
                                    </div>
                                  </div>
                                </div>
                                <div className="preview-card three-preview-card right-card">
                                  <div className="preview-card-inner">
                                    <div className="preview-card-back"></div>
                                    <div className="preview-card-front">
                                      <img
                                        src={cardImagePath("The High Priestess")}
                                        alt="Three Cards"
                                        className="preview-card-image"
                                      />
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div className="modal-bottom-buttons">
                            <button
                              className="custom-reading-overlay-button"
                              disabled={isLoading}
                              onClick={() => { playButtonSound(); setGameStage("custom"); }}
                            >
                              <img
                                src={ASSET("Assets/imagine/cr.png")}
                                alt="Custom Reading"
                                className="custom-reading-underlay-image"
                              />
                            </button>
                          </div>
                        </div>
                      )}

                      <footer className="taro-footer">
                        {isAllRevealed && (
                          <div style={{ display: 'flex', gap: '1.5rem', justifyContent: 'center', width: '100%' }}>
                            <button className="taro-button secondary" onClick={() => { playButtonSound(); handleNewSpread(); }}>
                              &lt;
                            </button>
                          </div>
                        )}
                      </footer>
                    </div>
                  </div>
                </div>

                {isAllRevealed && selectedSpread === "CUSTOM" && (
                  <div className="get-reading-container">
                    {!aiInterpretation && !isGeneratingAI && (
                      <>
                        {(() => {
                          const question = (userQuestion || '').trim();
                          const isEmpty = !question || question.length < 3;
                          if (isEmpty) {
                            return (
                              <div style={{color:'#ffd700',marginBottom:'1rem',textAlign:'center',fontSize:'0.9rem'}}>
                                âš ï¸ Question missing. Please go back and enter your question first (at least 3 characters).
                              </div>
                            );
                          }
                          return null;
                        })()}
                        <button
                          className="taro-button"
                          onClick={() => {
                            playButtonSound();
                            const question=(userQuestion || '').trim();
                            if (!question || question.length<3) {
                              alert('Question is missing or too short. Please go back and enter your question again (at least 3 characters).');
                              setGameStage("custom");
                              return;
                            }
                            generateCustomInterpretation(revealedIds);
                          }}
                          disabled={isGeneratingAI || !userQuestion || !userQuestion.trim() || userQuestion.trim().length<3}
                        >
                          {isGeneratingAI ? "Generating..." : "Get Reading"}
                        </button>
                      </>
                    )}
                    {isGeneratingAI && (
                      <div className="taro-generating" style={{ color: "#ffd700" }}>
                        âœ¨ Generating reading...
                      </div>
                    )}
                    {aiInterpretation && (
                      <button
                        className="taro-button"
                        onClick={() => { playButtonSound(); setShowAiPanel(true); }}
                      >
                        Get Reading
                      </button>
                    )}
                  </div>
                )}

                {gameStage === "animating" && (
                  <div className="taro-animating">
                  </div>
                )}
              </main>

              {showGallery && (
                <div className="taro-reading-overlay" onClick={() => setShowGallery(false)}>
                  <div className="gallery-modal" onClick={(e) => e.stopPropagation()}>
                    <div className="gallery-content">
                      <div className="gallery-section">
                        <h3>âœ§ MAJOR ARCANA âœ§</h3>
                        <div className="gallery-grid">
                          {ALL_CARDS.slice(0, 22).map((card) => (
                            <div key={card.id} className="gallery-card" onClick={() => {
                              playButtonSound();
                              setReadingSource('gallery');
                              setActiveCard(card);
                              setGameStage("reading");
                            }} aria-label={card.name} title={card.name}>
                              {!brokenImages[card.id] ? (
                                <img src={cardImagePath(card.name)} alt={card.name} onError={() => setBrokenImages(m => ({...m, [card.id]: true}))} />
                              ) : (
                                <div className="gallery-card-fallback">
                                  <div className="gallery-card-name">{card.name}</div>
                                  <div className="gallery-card-keyword">{card.keyword}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="gallery-section">
                        <h3>âœ§ WANDS âœ§</h3>
                        <div className="gallery-grid">
                          {ALL_CARDS.slice(22, 36).map((card) => (
                            <div key={card.id} className="gallery-card" onClick={() => {
                              playButtonSound();
                              setReadingSource('gallery');
                              setActiveCard(card);
                              setGameStage("reading");
                            }} aria-label={card.name} title={card.name}>
                              {!brokenImages[card.id] ? (
                                <img src={cardImagePath(card.name)} alt={card.name} onError={() => setBrokenImages(m => ({...m, [card.id]: true}))} />
                              ) : (
                                <div className="gallery-card-fallback">
                                  <div className="gallery-card-name">{card.name}</div>
                                  <div className="gallery-card-keyword">{card.keyword}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="gallery-section">
                        <h3>âœ§ CUPS âœ§</h3>
                        <div className="gallery-grid">
                          {ALL_CARDS.slice(36, 50).map((card) => (
                            <div key={card.id} className="gallery-card" onClick={() => {
                              playButtonSound();
                              setReadingSource('gallery');
                              setActiveCard(card);
                              setGameStage("reading");
                            }} aria-label={card.name} title={card.name}>
                              {!brokenImages[card.id] ? (
                                <img src={cardImagePath(card.name)} alt={card.name} onError={() => setBrokenImages(m => ({...m, [card.id]: true}))} />
                              ) : (
                                <div className="gallery-card-fallback">
                                  <div className="gallery-card-name">{card.name}</div>
                                  <div className="gallery-card-keyword">{card.keyword}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="gallery-section">
                        <h3>âœ§ SWORDS âœ§</h3>
                        <div className="gallery-grid">
                          {ALL_CARDS.slice(50, 64).map((card) => (
                            <div key={card.id} className="gallery-card" onClick={() => {
                              playButtonSound();
                              setReadingSource('gallery');
                              setActiveCard(card);
                              setGameStage("reading");
                            }} aria-label={card.name} title={card.name}>
                              {!brokenImages[card.id] ? (
                                <img src={cardImagePath(card.name)} alt={card.name} onError={() => setBrokenImages(m => ({...m, [card.id]: true}))} />
                              ) : (
                                <div className="gallery-card-fallback">
                                  <div className="gallery-card-name">{card.name}</div>
                                  <div className="gallery-card-keyword">{card.keyword}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="gallery-section">
                        <h3>âœ§ PENTACLES âœ§</h3>
                        <div className="gallery-grid">
                          {ALL_CARDS.slice(64, 78).map((card) => (
                            <div key={card.id} className="gallery-card" onClick={() => {
                              playButtonSound();
                              setReadingSource('gallery');
                              setActiveCard(card);
                              setGameStage("reading");
                            }} aria-label={card.name} title={card.name}>
                              {!brokenImages[card.id] ? (
                                <img src={cardImagePath(card.name)} alt={card.name} onError={() => setBrokenImages(m => ({...m, [card.id]: true}))} />
                              ) : (
                                <div className="gallery-card-fallback">
                                  <div className="gallery-card-name">{card.name}</div>
                                  <div className="gallery-card-keyword">{card.keyword}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                    <button className="gallery-close-btn" onClick={() => {
                      playButtonSound();
                      setShowGallery(false);
                      setGameStage(previousGameStage);
                      setReadingSource(null);
                      setActiveCard(null);
                    }}>
                      Close Gallery
                    </button>
                  </div>
                </div>
              )}

              {activeCard && (gameStage === "reading" || readingSource === 'gallery') && (
                <div className="taro-reading-overlay" style={{ zIndex: 2100 }} onClick={handleCloseReading}>
                  <div className="taro-reading-panel" onClick={(e) => e.stopPropagation()}>
                    {activeCard.positionLabel && (
                      <p className="taro-reading-position">{activeCard.positionLabel}</p>
                    )}
                    {!brokenImages[activeCard.id] && (
                      <div className="taro-reading-card-image card-media">
                        <img className="card-image" src={cardImagePath(activeCard.name)} alt={activeCard.name} />
                      </div>
                    )}
                    <div className="taro-reading-divider"></div>
                    <p className="taro-reading-keyword">âœ¦ {activeCard.keyword} âœ¦</p>
                    <p className="taro-reading-text">{activeCard.description}</p>
                    <button className="taro-reading-close-btn" onClick={handleCloseReading}>Close</button>
                  </div>
                </div>
              )}

              {selectedSpread === "CUSTOM" && isAllRevealed && aiInterpretation && showAiPanel && (
                <div className="taro-reading-overlay" onClick={() => setShowAiPanel(false)}>
                  <div className="taro-reading-panel taro-ai-panel" onClick={(e) => e.stopPropagation()}>
                    <h2 className="taro-ai-title">âœ§ Your Personalized Reading âœ§</h2>
                    <div className="taro-ai-question-chip">
                      <span className="taro-ai-question-text">"{userQuestion}"</span>
                    </div>
                    {isGeneratingAI ? (
                      <div className="taro-ai-loading">
                        Generating reading...
                      </div>
                    ) : (
                      <div className="taro-ai-content" dangerouslySetInnerHTML={{ __html: sanitizeHTML(aiInterpretation) }} />
                    )}
                    <button className="taro-reading-close-btn" onClick={() => setShowAiPanel(false)}>
                      Close
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      const root=ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(React.StrictMode, null, React.createElement(TaroApp, null)));
    </script>

    <style>
    *{box-sizing:border-box;}
html,body{height:100%;margin:0;padding:0;padding-top:var(--safe-area-inset-top,0);padding-bottom:var(--safe-area-inset-bottom,0);padding-left:var(--safe-area-inset-left,0);padding-right:var(--safe-area-inset-right,0);overflow-x:hidden;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overscroll-behavior:none;-webkit-overflow-scrolling:auto;}
#root{height:100%;width:100%;position:relative;}:root{--safe-area-inset-top:env(safe-area-inset-top,0);--safe-area-inset-bottom:env(safe-area-inset-bottom,0);--safe-area-inset-left:env(safe-area-inset-left,0);--safe-area-inset-right:env(safe-area-inset-right,0);--vh:1vh;--pad:clamp(12px,3vw,32px);--space:var(--pad);--tableW:min(100vw,900px);--tableAR:1 / 0.8;--tableH:calc(var(--tableW) * 0.8);--card-w:clamp(92px,22vw,140px);--card-ratio:1.55;--card-h:calc(var(--card-w) * var(--card-ratio));--cardW:var(--card-w);--cardH:var(--card-h);--deckW:clamp(100px,24vw,140px);--deckH:calc(var(--deckW) * 1.46);--h1:clamp(20px,5vw,36px);--p:clamp(12px,3vw,16px);}
@media (orientation:landscape) and (max-height:500px){:root{--tableAR:1 / 0.5;--tableH:calc(var(--tableW) * 0.5);--card-w:clamp(92px,26vw,132px);--cardW:var(--card-w);--deckW:clamp(87px,21vw,127px);}
}
.taro-root{position:relative;min-height:100dvh;min-height:calc(var(--vh,1vh) * 100);width:100%;overflow-x:hidden;font-family:'Georgia','Times New Roman',serif;}
.taro-background{position:fixed;top:0;left:0;width:100vw;height:100dvh;height:calc(var(--vh,1vh) * 100);background-image:var(--bg-url,url('./Assets/imagine/b.png'));background-repeat:no-repeat;background-attachment:scroll;z-index:0;background-size:cover;background-position:center center;}
@media (max-width:768px){.taro-background{background-attachment:scroll;background-position:center 40%;}
}
@media (max-width:768px) and (max-height:700px){.taro-background{background-position:center 35%;}
}
.taro-background::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);animation:backgroundPulse 8s ease-in-out infinite;}
@keyframes backgroundPulse{0%,100%{opacity:0.5;}
50%{opacity:0.8;}
}
.taro-container{position:relative;z-index:1;min-height:100dvh;min-height:calc(var(--vh,1vh) * 100);display:flex;flex-direction:column;padding:calc(var(--pad) + 60px + var(--safe-area-inset-top,0)) var(--pad) var(--pad) var(--pad);width:100%;box-sizing:border-box;}
.taro-header{text-align:center;margin-bottom:0.25rem;color:#fff;}
.taro-header h1{font-size:calc(var(--h1) * 1.2);margin:0;position:fixed;top:calc(10px + env(safe-area-inset-top,0));left:0;right:0;width:100%;display:block;text-align:center;z-index:1001;color:rgba(255,255,255,0.9);text-shadow:0 0 5px rgba(0,123,255,0.8),0 0 10px rgba(0,123,255,0.6),0 0 15px rgba(0,123,255,0.4),0 0 20px rgba(255,255,255,0.2);animation:liquidText 4s ease-in-out infinite;}
.taro-header h1::before{content:'cbTaro';position:absolute;top:0;left:0;width:100%;height:100%;color:rgba(255,255,255,0.1);text-shadow:0 0 10px rgba(0,123,255,0.5),0 0 20px rgba(0,123,255,0.3),0 0 30px rgba(255,255,255,0.2);filter:blur(1px);animation:liquidFlow 6s ease-in-out infinite;z-index:-1;}
.taro-header h1::after{content:'cbTaro';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,rgba(0,123,255,0.1),rgba(255,255,255,0.2),rgba(0,123,255,0.1));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:blur(0.5px);animation:liquidShimmer 3s ease-in-out infinite alternate;z-index:-2;}
@keyframes titleGlow{0%,100%{filter:brightness(1);}
50%{filter:brightness(1.3);}
}
@keyframes liquidText{0%,100%{transform:scale(1);filter:brightness(1) blur(0px);}
50%{transform:scale(1.01);filter:brightness(1.1) blur(0.5px);}
}
@keyframes liquidFlow{0%,100%{transform:translateX(0px) scale(1);}
25%{transform:translateX(1px) scale(1.005);}
50%{transform:translateX(0px) scale(1);}
75%{transform:translateX(-1px) scale(0.995);}
}
@keyframes liquidShimmer{0%{opacity:0.3;filter:hue-rotate(0deg);}
100%{opacity:0.7;filter:hue-rotate(10deg);}
}
.taro-header p{font-size:calc(var(--p) * 0.7);color:rgba(255,255,255,0.8);margin:0;}
.taro-hash{text-align:center;padding:1rem;background:rgba(0,0,0,0.3);border-radius:8px;margin-bottom:1rem;color:#fff;}
.taro-hash code{display:block;margin-top:0.5rem;font-family:'Courier New',monospace;color:#4ade80;word-break:break-all;}
.taro-main{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:var(--pad) 0;min-height:0;}
.taro-table-wrap{position:relative;transform:translateY(clamp(-10vh, -8vh, -3vh));transform-origin:center center;will-change:transform;}
.get-reading-container{position:relative;display:flex;justify-content:center;align-items:center;width:100%;margin-top:clamp(-56px, -14vh, -28px) !important;z-index:20;}
.taro-table{position:relative;width:var(--tableW);aspect-ratio:var(--tableAR);background:rgba(255,255,255,0.05);border-radius:50%;border:1px solid rgba(255,255,255,0.3);box-shadow:0 0 80px rgba(0,123,255,0.4),0 0 160px rgba(0,123,255,0.2),inset 0 0 30px rgba(255,255,255,0.05);margin:calc(var(--pad) * 0.1) auto;transition:box-shadow 0.3s ease;transform-origin:center center;transform:translateZ(0);overflow:visible;min-width:var(--tableW);max-width:var(--tableW);flex-shrink:0;will-change:transform;}
.taro-table-content{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;pointer-events:none;overflow:visible;}
.taro-table-content > *{pointer-events:auto;overflow:visible;}
.table-animating{animation:tablePulse 1.2s ease-in-out;box-shadow:0 0 120px rgba(0,123,255,0.6),0 0 240px rgba(0,123,255,0.3),inset 0 0 50px rgba(255,255,255,0.2);transform-origin:center center !important;margin:calc(var(--pad) * 0.1) auto !important;width:var(--tableW) !important;aspect-ratio:var(--tableAR) !important;border-radius:50% !important;min-width:var(--tableW) !important;max-width:var(--tableW) !important;}
@keyframes tablePulse{0%,100%{transform:translateZ(0) scale(1);}
50%{transform:translateZ(0) scale(1.05);}
}
.gallery-button-container{display:flex !important;flex-direction:column !important;align-items:flex-end !important;gap:4px !important;position:relative !important;z-index:10002 !important;overflow:visible !important;min-width:80px;}
.all-taro-wrap{display:flex !important;align-items:flex-start !important;justify-content:space-between !important;position:relative !important;z-index:5 !important;overflow:visible !important;gap:12px;}
.all-taro-right{display:flex !important;flex-direction:column !important;align-items:flex-end !important;gap:8px !important;position:relative !important;z-index:6 !important;}
.gallery-button{background:rgba(0,123,255,0.8);color:#fff;border:none;border-radius:12px;padding:12px 16px;font-size:28px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(0,123,255,0.3);min-width:64px;min-height:64px;}
.gallery-button:hover{background:rgba(0,123,255,1);transform:scale(1.05);box-shadow:0 6px 16px rgba(0,123,255,0.4);}
.control-buttons{position:fixed !important;top:calc(15px + var(--safe-area-inset-top,0)) !important;right:calc(15px + var(--safe-area-inset-right,0)) !important;display:flex !important;gap:6px !important;z-index:10000 !important;transform:none !important;transform-origin:initial !important;animation:none !important;transition:none !important;will-change:auto !important;pointer-events:auto !important;}
.control-buttons button{pointer-events:auto !important;z-index:10001 !important;}
.taro-root.animating .control-buttons,.taro-root.table-animating .control-buttons,.taro-animating ~ .control-buttons{position:fixed !important;top:calc(20px + var(--safe-area-inset-top,0)) !important;right:calc(20px + var(--safe-area-inset-right,0)) !important;transform:none !important;}
.taro-deck{position:relative;width:var(--deckW);height:var(--deckH);cursor:pointer;transition:transform 0.3s ease,box-shadow 0.3s ease;flex-shrink:0;}
.taro-deck:hover{transform:translateY(-5px) scale(1.05);filter:brightness(1.1);}
.taro-deck:active{transform:translateY(-2px) scale(1.02);}
.taro-deck-inner{width:100%;height:100%;background:linear-gradient(135deg,#2d1b3d 0%,#1a0a2e 100%);background-image:var(--cardback-url,url('./Assets/imagine/bc.png'));background-size:100% 100%;background-position:center;background-repeat:no-repeat;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5),inset 0 0 20px rgba(0,123,255,0.3);border:2px solid rgba(0,123,255,0.5);position:relative;}
.taro-modal{background:rgba(0,0,0,0.7);backdrop-filter:blur(10px);border-radius:15px;padding:0.75rem;text-align:center;max-height:85vh;border:2px solid rgba(0,123,255,0.5);box-shadow:0 0 40px rgba(0,123,255,0.4);max-width:100%;overflow:hidden;}
.taro-main > .taro-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;}
.taro-table-content .choosing-modal,.taro-table-content .custom-reading-modal{position:absolute !important;left:50% !important;top:50% !important;transform:translate(-50%,-50%) !important;width:clamp(280px,min(480px,calc(var(--tableW) * 0.85)),90vw) !important;max-width:calc(var(--tableW) * 0.9) !important;z-index:100 !important;pointer-events:auto !important;margin:0 !important;box-sizing:border-box;}
.choosing-modal{background:linear-gradient(135deg,rgba(0,123,255,0.05),rgba(0,50,150,0.05),rgba(0,123,255,0.03)
 );backdrop-filter:none;-webkit-backdrop-filter:none;border:none;box-shadow:none;border-radius:20px;padding:1rem;}
.custom-reading-modal{background:linear-gradient(135deg,rgba(0,123,255,0.15),rgba(0,50,150,0.15),rgba(0,123,255,0.1)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);border:1px solid rgba(255,255,255,0.2);box-shadow:0 8px 32px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1),inset 0 -1px 0 rgba(0,0,0,0.1);border-radius:20px;padding:2rem;}
.modal-header{display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:1.5rem;}
.modal-bottom-buttons{display:flex;justify-content:center;align-items:center;gap:16px;margin-top:16px;}
.modal-back-btn{background:linear-gradient(135deg,rgba(0,123,255,0.2),rgba(0,50,150,0.2),rgba(0,123,255,0.1)
 );backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);color:#fff;border:1px solid rgba(255,255,255,0.2);border-radius:2px;padding:2px 3px;font-size:5px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 8px 32px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1),inset 0 -1px 0 rgba(0,0,0,0.1);min-width:8px;}
.modal-back-btn:hover{background:linear-gradient(135deg,rgba(0,123,255,0.3),rgba(0,50,150,0.3),rgba(0,123,255,0.2)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);transform:scale(1.1);box-shadow:0 12px 40px rgba(0,123,255,0.4),inset 0 1px 0 rgba(255,255,255,0.2),inset 0 -1px 0 rgba(0,0,0,0.05);border-color:rgba(255,255,255,0.3);}
.sound-toggle-btn{background:linear-gradient(135deg,rgba(0,123,255,0.2),rgba(0,50,150,0.2),rgba(0,123,255,0.1)
 );backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);color:#fff;border:1px solid rgba(255,255,255,0.2);border-radius:12px;padding:12px 16px;font-size:28px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 12px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1),inset 0 -1px 0 rgba(0,0,0,0.1);margin-right:8px;min-width:64px;min-height:64px;}
.control-buttons-left{position:fixed;top:calc(20px + var(--safe-area-inset-top,0));left:calc(20px + var(--safe-area-inset-left,0));display:flex;flex-direction:column;gap:8px;z-index:10000;pointer-events:none;}
.control-buttons-left > *{pointer-events:auto;}
.sound-toggle-btn-left{position:relative !important;top:auto !important;left:auto !important;margin-right:0 !important;z-index:auto !important;}
.sound-toggle-btn:hover{background:linear-gradient(135deg,rgba(0,123,255,0.3),rgba(0,50,150,0.3),rgba(0,123,255,0.2)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);transform:scale(1.1);box-shadow:0 12px 40px rgba(0,123,255,0.4),inset 0 1px 0 rgba(255,255,255,0.2),inset 0 -1px 0 rgba(0,0,0,0.05);border-color:rgba(255,255,255,0.3);}
@keyframes spin{from{transform:rotate(0deg);}
to{transform:rotate(360deg);}
}
.modal-header h2{margin:0;flex:1;text-align:center;}
.custom-modal-content{display:flex;flex-direction:column;align-items:center;gap:clamp(24px,6vw,40px);max-width:500px;width:100%;box-sizing:border-box;}
.custom-modal-title{width:100%;text-align:center;margin:0;}
.custom-modal-hint{width:100%;text-align:center;margin:0;opacity:0.8;}
.custom-modal-prompt{text-align:center;color:rgba(255,255,255,0.88);font-size:clamp(1rem,2.5vw,1.2rem);font-weight:300;letter-spacing:0.08em;margin:0 0 clamp(16px,4vw,24px) 0;text-shadow:0 0 12px rgba(245,197,66,0.25);font-family:'Georgia',serif;line-height:1.5;}
.custom-modal-input{width:100%;padding:clamp(20px,5vw,28px) clamp(20px,5vw,28px);border:none;border-radius:16px;background:rgba(20,30,60,0.4);color:rgba(255,255,255,0.88);font-size:clamp(15px,3.5vw,17px);font-family:'Georgia',serif;resize:vertical;box-sizing:border-box;line-height:1.7;text-align:left;box-shadow:0 0 20px rgba(106,169,255,0.1),inset 0 0 15px rgba(245,197,66,0.05);transition:all 0.4s ease;min-height:120px;vertical-align:middle;}
.custom-modal-input:focus{outline:none;background:rgba(20,30,60,0.5);box-shadow:0 0 30px rgba(106,169,255,0.2),inset 0 0 20px rgba(245,197,66,0.08);}
.custom-modal-input::placeholder{color:rgba(255,255,255,0.5);font-style:italic;text-align:center;}
.custom-modal-actions{display:grid;grid-template-columns:1fr 1fr;gap:clamp(16px,4vw,24px);width:100%;margin-top:clamp(8px,2vw,16px);}
.custom-modal-btn{padding:clamp(14px,3.5vw,18px) clamp(24px,6vw,32px);border:none;border-radius:50px;font-size:clamp(15px,3.5vw,17px);font-weight:400;cursor:pointer;transition:all 0.3s ease;min-height:52px;box-sizing:border-box;font-family:'Georgia',serif;letter-spacing:0.05em;}
.custom-modal-btn.primary{background:rgba(245,197,66,0.15);color:rgba(245,197,66,0.95);box-shadow:0 0 20px rgba(245,197,66,0.2),inset 0 0 10px rgba(245,197,66,0.1);border:1px solid rgba(245,197,66,0.3);}
.custom-modal-btn.primary:hover:not(:disabled){background:rgba(245,197,66,0.2);box-shadow:0 0 30px rgba(245,197,66,0.3),inset 0 0 15px rgba(245,197,66,0.15);transform:translateY(-2px);}
.custom-modal-btn.secondary{background:rgba(255,255,255,0.04);color:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.1);opacity:0.7;}
.custom-modal-btn.secondary:hover:not(:disabled){background:rgba(255,255,255,0.06);opacity:0.9;border-color:rgba(255,255,255,0.15);}
.custom-modal-btn:disabled{opacity:0.4;cursor:not-allowed;}
.gallery-modal{background:rgba(10,15,35,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:24px;padding:clamp(1.5rem,4vw,2.5rem);width:95vw;max-height:85vh;max-width:1200px;overflow:hidden;border:none;box-shadow:0 0 60px rgba(20,30,60,0.6),inset 0 0 40px rgba(106,169,255,0.05);display:flex;flex-direction:column;z-index:1500;-webkit-overflow-scrolling:touch;}
.gallery-modal h2{color:rgba(255,255,255,0.9);text-align:center;margin-bottom:2rem;font-size:clamp(1.8rem,4vw,2.5rem);text-shadow:0 0 20px rgba(245,197,66,0.3);flex-shrink:0;font-family:'Georgia',serif;font-weight:300;letter-spacing:0.1em;}
.gallery-content{display:flex;flex-direction:column;gap:clamp(2.5rem,6vw,4rem);flex:1;overflow-y:auto;min-height:0;padding:0.5rem 0;}
.gallery-section h3{color:rgba(255,255,255,0.88);font-size:clamp(1.1rem,3vw,1.5rem);margin-bottom:clamp(1.5rem,4vw,2rem);text-align:center;letter-spacing:0.15em;font-weight:300;font-family:'Georgia',serif;text-shadow:0 0 15px rgba(245,197,66,0.25);position:relative;padding-bottom:clamp(0.75rem,2vw,1rem);}
.gallery-section h3::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:30%;height:1px;background:linear-gradient(to right,transparent,rgba(245,197,66,0.4),transparent);}
.gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:clamp(1rem,3vw,1.5rem) clamp(0.75rem,2vw,1rem);margin-bottom:0;}
.gallery-card{background:rgba(20,30,60,0.12);border-radius:16px;overflow:hidden;transition:all 0.4s cubic-bezier(0.25,0.46,0.45,0.94);cursor:pointer;border:1px solid rgba(255,255,255,0.05);box-shadow:0 0 12px rgba(106,169,255,0.06),inset 0 0 8px rgba(245,197,66,0.015);position:relative;aspect-ratio:1 / 1.55;}
.gallery-card:hover{transform:scale(1.05) translateY(-3px);box-shadow:0 0 30px rgba(106,169,255,0.2),0 0 20px rgba(245,197,66,0.12),inset 0 0 15px rgba(245,197,66,0.06);border-color:rgba(255,255,255,0.12);}
.gallery-card:hover img{filter:brightness(1.1);box-shadow:0 0 25px rgba(245,197,66,0.2);}
.gallery-card img{width:100%;height:100%;object-fit:cover;display:block;border-radius:16px;transition:all 0.4s ease;padding:0;box-sizing:border-box;}
.gallery-card-fallback{width:100%;height:clamp(180px,22vw,220px);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:12px;background:rgba(20,30,60,0.3);border:1px solid rgba(255,255,255,0.08);border-radius:16px;text-align:center;box-shadow:inset 0 0 12px rgba(106,169,255,0.08);}
.gallery-card-fallback .gallery-card-name{color:rgba(255,255,255,0.88);font-size:clamp(10px,2vw,12px);font-weight:400;margin-bottom:4px;line-height:1.2;font-family:'Georgia',serif;}
.gallery-card-fallback .gallery-card-keyword{color:rgba(106,169,255,0.7);font-size:clamp(8px,1.8vw,10px);font-style:italic;line-height:1.2;}
.gallery-card-info{display:none !important;}
.gallery-card-name{color:rgba(245,197,66,0.9);font-size:clamp(10px,2vw,12px);font-weight:300;margin:0;line-height:1.3;font-family:'Georgia',serif;letter-spacing:0.03em;}
.gallery-card-keyword{display:none;}
.gallery-close-btn{display:block;margin:clamp(2rem,5vw,3rem) auto 0;background:rgba(255,255,255,0.04);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);color:rgba(255,255,255,0.7);border:1px solid rgba(255,255,255,0.12);border-radius:50px;padding:clamp(12px,3vw,16px) clamp(28px,6vw,36px);font-size:clamp(14px,3vw,16px);font-weight:300;cursor:pointer;transition:all 0.3s ease;box-shadow:0 0 15px rgba(106,169,255,0.1);flex-shrink:0;font-family:'Georgia',serif;letter-spacing:0.08em;}
.gallery-close-btn:hover{background:rgba(255,255,255,0.06);box-shadow:0 0 25px rgba(106,169,255,0.2),0 0 15px rgba(245,197,66,0.1);border-color:rgba(255,255,255,0.18);color:rgba(255,255,255,0.85);transform:translateY(-1px);}
.taro-main{min-height:unset;}
@media (max-width:768px){.taro-container{overflow-y:auto;min-height:calc(var(--vh,1vh) * 100);}
.taro-reading-overlay,.taro-modal,.gallery-modal{padding:var(--pad);}
.taro-reading-panel,.taro-modal,.gallery-modal{max-height:calc(100svh - (var(--pad) * 2) - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0));overflow-y:auto;width:min(92vw,600px);margin:0 auto;}
.custom-modal-content{gap:var(--pad);max-width:100%;}
.custom-modal-input{font-size:16px;}
.custom-modal-actions{gap:calc(var(--pad) / 2);}
.custom-modal-btn{min-height:44px;font-size:14px;}
}
@media (min-width:769px){.taro-main{min-height:400px;}
.taro-reading-panel,.taro-modal,.gallery-modal{max-height:80vh;width:auto;margin:0;}
}
.taro-modal h2{color:#fff;margin-bottom:0.5rem;font-size:1.2rem;}
.taro-option{display:block;width:100%;max-width:300px;margin:1rem auto;padding:1rem 2rem;font-size:1.2rem;background:linear-gradient(135deg,rgba(0,123,255,0.15),rgba(0,50,150,0.15),rgba(0,123,255,0.1)
 );backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.2);border-radius:12px;color:#fff;cursor:pointer;transition:all 0.3s ease;font-family:inherit;box-shadow:0 8px 32px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1),inset 0 -1px 0 rgba(0,0,0,0.1);}
.taro-option:hover:not(:disabled){background:linear-gradient(135deg,rgba(0,123,255,0.25),rgba(0,50,150,0.25),rgba(0,123,255,0.2)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);transform:translateY(-2px);box-shadow:0 12px 40px rgba(0,123,255,0.4),inset 0 1px 0 rgba(255,255,255,0.2),inset 0 -1px 0 rgba(0,0,0,0.05);border-color:rgba(255,255,255,0.3);}
.taro-option:disabled{opacity:0.5;cursor:not-allowed;}
.custom-reading-overlay-button{position:relative;width:133px;height:44px;border:none;background:transparent;border-radius:8px;transition:all 0.3s ease;cursor:pointer;padding:0;margin:0;display:inline-block;overflow:hidden;box-sizing:border-box;}
.custom-reading-overlay-button:hover:not(:disabled){transform:translateY(-2px) scale(1.05);box-shadow:0 8px 25px rgba(0,123,255,0.4);}
.custom-reading-overlay-button:disabled{opacity:0.5;cursor:not-allowed;}
.custom-reading-underlay-image{display:block;width:100%;height:100%;object-fit:cover;border-radius:8px;margin:0;padding:0;position:absolute;top:0;left:0;}
.taro-custom-modal{max-width:500px;width:90%;}
.spread-selection{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto auto;gap:0.5rem clamp(0.75rem,2vw,1.5rem);margin:calc(var(--pad) * 0.25) 0;justify-items:center;align-items:center;max-width:100%;}
@media (max-width:768px){.spread-selection{gap:calc(var(--pad) * 0.25);margin:calc(var(--pad) * 0.125) 0;}
.spread-option{width:100%;max-width:160px;}
}
.spread-option{display:flex;flex-direction:column;align-items:center;transition:opacity 0.3s ease;cursor:pointer;transform:scale(0.75);}
.single-card-option{grid-column:1;grid-row:1;transform:translateX(20px);}
.three-cards-option{grid-column:2;grid-row:1;transform:translateX(-20px);}
.custom-reading-button{grid-column:1 / -1;grid-row:2;justify-self:center;}
.spread-preview{display:flex;justify-content:center;align-items:center;margin-bottom:1rem;position:relative;}
.preview-card{width:var(--card-w);height:var(--card-h);position:relative;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:transform 0.3s ease;}
.preview-card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.6s ease;}
.preview-card-back,.preview-card-front{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:8px;}
.preview-card-back{background-image:var(--cardback-url,url('./Assets/imagine/bc.png'));background-size:140% 140%;background-position:center;background-repeat:no-repeat;border:1px solid rgba(138,43,226,0.3);}
.preview-card-front{background:rgba(245,245,220,0.9);transform:rotateY(180deg);border:1px solid rgba(138,43,226,0.2);display:flex;align-items:center;justify-content:center;overflow:hidden;}
.preview-card-image{width:100%;height:100%;object-fit:fill;border-radius:6px;}
.three-preview-card{position:absolute;}
.left-card{transform:rotate(-15deg) translateX(-30px);z-index:1;}
.center-card{z-index:2;}
.right-card{transform:rotate(15deg) translateX(30px);z-index:1;}
.choosing-modal .preview-card,.choosing-modal .single-preview-card,.choosing-modal .three-preview-card,.choosing-modal .preview-card-inner{width:var(--card-w) !important;height:var(--card-h) !important;border-radius:8px !important;}
.choosing-modal .preview-card{border:1px solid rgba(255,255,255,0.2) !important;box-shadow:0 4px 16px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1) !important;}
.choosing-modal .three-preview-card.left-card{transform:rotate(-10deg) translateX(-18px) !important;}
.choosing-modal .three-preview-card.right-card{transform:rotate(10deg) translateX(18px) !important;}
.choosing-modal .three-preview-card.center-card{z-index:2 !important;}
.custom-reading-button{margin-top:1rem;width:100%;}
.taro-custom-hint{color:rgba(255,255,255,0.8);font-size:1rem;margin-bottom:0.5rem;font-style:italic;}
.taro-custom-note{color:rgba(255,215,0,0.8);font-size:0.9rem;margin-bottom:1rem;font-weight:500;}
.taro-question-input{width:100%;padding:1rem;font-size:1rem;font-family:inherit;background:rgba(255,255,255,0.1);border:2px solid rgba(0,123,255,0.5);border-radius:12px;color:#fff;resize:vertical;margin-bottom:1.5rem;transition:all 0.3s ease;}
.taro-question-input:focus{outline:none;border-color:rgba(0,123,255,0.8);background:rgba(255,255,255,0.15);box-shadow:0 0 20px rgba(0,123,255,0.3);}
.taro-question-input::placeholder{color:rgba(255,255,255,0.5);}
.taro-custom-buttons{display:flex;gap:1rem;justify-content:center;}
.taro-custom-buttons .taro-button{flex:1;max-width:150px;}
.taro-ai-panel{max-width:700px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:3rem 2.5rem;}
.taro-ai-title{font-size:1.4rem;font-weight:300;letter-spacing:0.1em;text-align:center;color:rgba(255,255,255,0.9);margin:0 0 2rem 0;text-shadow:0 0 12px rgba(245,197,66,0.3);font-family:'Georgia',serif;}
.taro-ai-question-chip{display:inline-block;padding:0.6rem 1.4rem;background:rgba(255,255,255,0.06);border-radius:50px;margin:0 0 2.5rem 0;box-shadow:0 0 20px rgba(106,169,255,0.15),inset 0 0 10px rgba(245,197,66,0.1);border:1px solid rgba(255,255,255,0.08);}
.taro-ai-question-text{font-size:0.9rem;color:rgba(255,255,255,0.75);font-style:italic;letter-spacing:0.03em;font-weight:300;}
.taro-ai-content{width:100%;max-width:90%;text-align:center;color:rgba(255,255,255,0.8);font-family:'Georgia',serif;font-weight:300;line-height:1.9;font-size:0.95rem;white-space:pre-wrap;}
.taro-ai-content br{display:block;margin:0.5rem 0;}
.taro-ai-content br + br{margin:1.5rem 0;}
.taro-ai-section{display:block;margin:2.5rem 0;position:relative;padding-top:2rem;}
.taro-ai-section::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);height:1px;width:50%;background:linear-gradient(to right,transparent,rgba(245,197,66,0.4),rgba(138,43,226,0.3),rgba(245,197,66,0.4),transparent);box-shadow:0 0 8px rgba(245,197,66,0.2);}
.taro-ai-section-title{display:block;color:rgba(245,197,66,0.85);font-weight:400;font-size:1rem;letter-spacing:0.08em;margin:0 0 1.2rem 0;text-shadow:0 0 10px rgba(245,197,66,0.25);text-transform:none;}
.taro-ai-content p{margin:0 0 1.5rem 0;padding:0;color:rgba(255,255,255,0.8);}
.taro-ai-content strong{color:rgba(245,197,66,0.85);font-weight:400;font-size:1rem;letter-spacing:0.05em;display:block;margin:2rem 0 1rem 0;text-shadow:0 0 8px rgba(245,197,66,0.2);position:relative;padding-top:1.5rem;}
.taro-ai-content strong::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);height:1px;width:50%;background:linear-gradient(to right,transparent,rgba(245,197,66,0.4),rgba(138,43,226,0.3),rgba(245,197,66,0.4),transparent);box-shadow:0 0 6px rgba(245,197,66,0.15);}
.taro-ai-content strong:first-child::before{display:none;}
.taro-ai-section-title{color:rgba(245,197,66,0.85);font-weight:400;font-size:1rem;letter-spacing:0.08em;display:block;margin:2.5rem 0 1.2rem 0;text-shadow:0 0 10px rgba(245,197,66,0.25);position:relative;padding-top:1.5rem;text-transform:none;}
.taro-ai-section-title::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);height:1px;width:50%;background:linear-gradient(to right,transparent,rgba(245,197,66,0.4),rgba(138,43,226,0.3),rgba(245,197,66,0.4),transparent);box-shadow:0 0 8px rgba(245,197,66,0.2);}
.taro-ai-section-title:first-child::before{display:none;}
.taro-ai-content em{font-style:italic;color:rgba(255,255,255,0.75);}
.taro-ai-loading{text-align:center;padding:2rem;color:rgba(255,255,255,0.7);font-weight:300;letter-spacing:0.05em;}
.taro-ai-loading .taro-sparkles{font-size:3rem;animation:sparkle 1s ease-in-out infinite;margin-bottom:1rem;}
.taro-generating{display:flex;align-items:center;gap:0.5rem;font-style:italic;color:rgba(255,255,255,0.7);font-weight:300;}
@keyframes sparkle{0%,100%{transform:scale(1) rotate(0deg);opacity:0.7;}
50%{transform:scale(1.2) rotate(180deg);opacity:1;}
}
.taro-animating{text-align:center;color:#fff;position:relative;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;}
@keyframes fadeInOut{0%,100%{opacity:0.5;}
50%{opacity:1;}
}
.taro-spread{display:flex;justify-content:center;align-items:center;gap:var(--pad);flex-wrap:wrap;width:100%;perspective:1000px;transform:translateZ(0);will-change:contents;overflow:visible;}
.card-slot{position:relative;width:var(--card-w);height:var(--card-h);flex-shrink:0;display:block;}
.card-anim{width:100%;height:100%;cursor:pointer;position:relative;transform-style:preserve-3d;will-change:transform;opacity:1;display:block;min-height:1px;transform:translateZ(0);backface-visibility:hidden;overflow:visible;}
.card-slot.card-single .card-anim,.card-slot.card-left .card-anim,.card-slot.card-center .card-anim,.card-slot.card-right .card-anim{opacity:0;}
.taro-card{width:var(--card-w);height:var(--card-h);cursor:pointer;position:relative;transition:transform 0.3s ease;opacity:0;flex-shrink:0;transform-style:preserve-3d;}
.card-slot.card-single .card-anim{animation:dealerThrowFromTopCenter 0.6s cubic-bezier(0.25,0.46,0.45,0.94) 0.2s forwards;}
@keyframes dealerThrowFromTopCenter{0%{opacity:0;transform:translateZ(0) rotate(-180deg) scale(0.8);}
60%{opacity:1;transform:translateZ(0) rotate(5deg) scale(1);}
80%{transform:translateZ(0) rotate(-2deg) scale(1);}
100%{opacity:1;transform:translateZ(0) translate3d(0,0,0) rotate(0deg) scale(1);}
}
.card-slot.card-left .card-anim{animation:dealerThrowFromTopLeft 0.6s cubic-bezier(0.25,0.46,0.45,0.94) 0.2s forwards;}
.card-slot.card-center .card-anim{animation:dealerThrowFromTopCenterCard 0.6s cubic-bezier(0.25,0.46,0.45,0.94) 0.4s forwards;}
.card-slot.card-right .card-anim{animation:dealerThrowFromTopRight 0.6s cubic-bezier(0.25,0.46,0.45,0.94) 0.6s forwards;}
@keyframes dealerThrowFromTopLeft{0%{opacity:0;transform:translateZ(0) rotate(-180deg) scale(0.8);}
60%{opacity:1;transform:translateZ(0) rotate(-12deg) scale(1);}
80%{transform:translateZ(0) rotate(-15deg) scale(1);}
100%{opacity:1;transform:translateZ(0) translate3d(0,0,0) rotate(-15deg) scale(1);}
}
@keyframes dealerThrowFromTopCenterCard{0%{opacity:0;transform:translateZ(0) rotate(-180deg) scale(0.8);}
60%{opacity:1;transform:translateZ(0) rotate(5deg) scale(1);}
80%{transform:translateZ(0) rotate(-2deg) scale(1);}
100%{opacity:1;transform:translateZ(0) translate3d(0,0,0) rotate(0deg) scale(1);}
}
@keyframes dealerThrowFromTopRight{0%{opacity:0;transform:translateZ(0) rotate(-180deg) scale(0.8);}
60%{opacity:1;transform:translateZ(0) rotate(12deg) scale(1);}
80%{transform:translateZ(0) rotate(15deg) scale(1);}
100%{opacity:1;transform:translateZ(0) translate3d(0,0,0) rotate(15deg) scale(1);}
}
.card-anim:hover{transform:translateZ(0) translateY(-10px) scale(1);}
.card-slot.card-left .card-anim:hover{transform:translateZ(0) translateY(-10px) rotate(-15deg) scale(1);}
.card-slot.card-right .card-anim:hover{transform:translateZ(0) translateY(-10px) rotate(15deg) scale(1);}
.taro-card:hover{transform:translateY(-10px);}
.taro-card.card-left:hover{transform:rotate(-15deg) translateY(-10px);}
.taro-card.card-right:hover{transform:rotate(15deg) translateY(-10px);}
.taro-card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.6s ease;}
.card-anim.card-revealed .taro-card-inner{transform:rotateY(180deg);}
.taro-card.card-revealed .taro-card-inner{transform:rotateY(180deg);}
.taro-card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5);background-image:var(--cardback-url,url('./Assets/imagine/bc.png'));background-size:100% 100%;background-position:center;background-repeat:no-repeat;background-origin:border-box;background-clip:border-box;border:2px solid rgba(0,123,255,0.5);overflow:hidden;display:flex;justify-content:center;align-items:center;}
.taro-card-front{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5);border:2px solid rgba(0,123,255,0.3);transform:rotateY(180deg);padding:0;margin:0;display:block;overflow:hidden;position:relative;}
.taro-card-image{width:100%;height:100%;object-fit:contain;display:block;position:absolute;top:0;left:0;border-radius:inherit;}
.taro-card-fallback{padding:1rem;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center;}
.taro-card-name{font-size:1.1rem;font-weight:bold;margin-bottom:0.5rem;color:#007bff;}
.taro-card-keyword{font-size:0.9rem;font-style:italic;color:#4a5568;margin-bottom:0.5rem;}
.taro-footer{position:absolute;bottom:clamp(calc(var(--pad) * 0.15), calc(var(--pad) * 0.2 + var(--safe-area-inset-bottom,0) * 0.3), calc(var(--pad) * 0.3));left:50%;transform:translateX(-50%);text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:clamp(0, 0.75rem, 1rem);z-index:20;width:auto;max-width:calc(var(--tableW) - var(--pad) * 2);pointer-events:auto;}
.taro-button{padding:clamp(0.2rem, 1vw, 1rem) clamp(0.5rem, 2.5vw, 2.5rem);font-size:clamp(0.7rem, 1.2vw, 1.2rem);background:linear-gradient(135deg,rgba(0,123,255,0.2),rgba(0,50,150,0.2),rgba(0,123,255,0.1)
 );backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.2);border-radius:9px;color:#fff;cursor:pointer;transition:all 0.3s ease;font-family:'Georgia','Times New Roman',serif;font-weight:300;letter-spacing:0.05em;box-shadow:0 8px 32px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1),inset 0 -1px 0 rgba(0,0,0,0.1);}
.taro-button:hover{background:linear-gradient(135deg,rgba(0,123,255,0.3),rgba(0,50,150,0.3),rgba(0,123,255,0.2)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);transform:translateY(-2px);box-shadow:0 12px 40px rgba(0,123,255,0.4),inset 0 1px 0 rgba(255,255,255,0.2),inset 0 -1px 0 rgba(0,0,0,0.05);border-color:rgba(255,255,255,0.3);}
.taro-button.secondary{background:linear-gradient(135deg,rgba(0,50,150,0.2),rgba(0,123,255,0.2),rgba(0,50,150,0.1)
 );}
.taro-button.secondary:hover{background:linear-gradient(135deg,rgba(0,50,150,0.3),rgba(0,123,255,0.3),rgba(0,50,150,0.2)
 );backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);border-color:rgba(255,255,255,0.3);}
.taro-reading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);z-index:2000;display:flex;justify-content:center;align-items:center;padding:2rem;animation:fadeIn 0.3s ease;isolation:isolate;overscroll-behavior:contain;}
@keyframes fadeIn{from{opacity:0;}
to{opacity:1;}
}
.taro-reading-panel{background:radial-gradient(ellipse at center,rgba(15,20,45,0.98),rgba(5,8,20,0.99));border:none;border-radius:24px;padding:3rem 2.5rem;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;color:#fff;box-shadow:0 0 60px rgba(106,169,255,0.15),0 0 120px rgba(138,43,226,0.1);animation:slideUp 0.3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:auto;-webkit-overflow-scrolling:touch;}
@keyframes slideUp{from{transform:translateY(50px);opacity:0;}
to{transform:translateY(0);opacity:1;}
}
.taro-reading-position{font-size:0.7rem;letter-spacing:0.15em;text-transform:uppercase;color:rgba(106,169,255,0.7);opacity:0.8;margin:0 0 2rem 0;font-weight:300;text-align:center;}
.taro-reading-card-image{text-align:center;margin:2rem 0;transform:none;position:relative;}
.taro-reading-card-image img,.card-image{width:100%;max-width:260px;height:auto;object-fit:contain;border-radius:12px;border:1px solid rgba(245,197,66,0.2);box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 40px rgba(245,197,66,0.15),0 0 80px rgba(138,43,226,0.1);display:block;margin:0 auto;transform:none;scale:1;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.5));}
.taro-reading-divider{height:1px;width:50%;margin:2.5rem auto;background:linear-gradient(to right,transparent,rgba(245,197,66,0.4),rgba(138,43,226,0.3),rgba(245,197,66,0.4),transparent);box-shadow:0 0 8px rgba(245,197,66,0.2);}
.taro-reading-keyword{font-size:1.1rem;font-style:italic;color:rgba(245,197,66,0.85);text-align:center;margin:1.5rem 0;font-weight:300;letter-spacing:0.08em;opacity:0.9;}
.taro-reading-text{font-size:0.95rem;line-height:1.8;color:rgba(255,255,255,0.75);margin:0;padding:0;text-align:center;font-family:'Georgia',serif;font-weight:300;max-width:90%;}
.taro-reading-close-btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);border-radius:6px;padding:0.6rem 2rem;color:rgba(255,255,255,0.7);cursor:pointer;transition:all 0.25s ease;font-size:0.75rem;letter-spacing:0.15em;text-transform:uppercase;margin-top:2.5rem;font-family:inherit;font-weight:300;}
.taro-reading-close-btn:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.2);color:rgba(255,255,255,0.85);}
@media (max-width:480px){.card-media{display:flex;justify-content:center;align-items:center;overflow:visible;margin:1.5rem 0;}
.card-image{width:min(50vw,260px) !important;max-width:260px !important;height:auto;max-height:40vh;object-fit:contain;}
.taro-reading-panel{width:min(92vw,560px);max-height:90vh;padding:2rem 1.5rem;min-height:auto;}
.taro-reading-text{font-size:0.85rem;line-height:1.7;max-width:95%;}
.taro-reading-keyword{font-size:0.95rem;margin:1rem 0;}
.taro-reading-divider{width:60%;margin:2rem auto;}
}
@media (max-width:768px){.taro-container{padding:calc(var(--pad) + 60px + var(--safe-area-inset-top,0)) var(--pad) var(--pad) var(--pad);min-height:calc(var(--vh,1vh) * 100);height:auto;}
.taro-header{margin-bottom:0.5rem;}
.taro-header h1{font-size:1.2rem;margin:0;position:fixed !important;top:calc(8px + var(--safe-area-inset-top,0)) !important;left:0 !important;right:0 !important;width:100% !important;display:block !important;text-align:center !important;z-index:1001 !important;}
.taro-header p{font-size:0.7rem;margin-top:0.1rem;}
.taro-main{justify-content:center !important;}
.taro-table-wrap{transform:translateY(clamp(-8vh, -6vh, -3vh)) !important;}
.taro-table{min-height:150px;padding:0.25rem;margin:calc(var(--pad) * 0.1) 0 !important;}
.card-slot{width:var(--card-w);height:var(--card-h);}
.taro-card{width:var(--card-w);height:var(--card-h);}
.taro-spread{gap:0.5rem;}
.three-preview-card.left-card{transform:rotate(-8deg) translateX(-8px);}
.three-preview-card.right-card{transform:rotate(8deg) translateX(8px);}
.taro-reading-panel{padding:1.5rem 1rem !important;max-height:85vh !important;min-height:auto !important;}
.taro-reading-overlay{transform:none !important;scale:1 !important;}
.taro-reading-panel{transform:none !important;scale:1 !important;}
.taro-reading-panel *{transform:none !important;scale:1 !important;}
.taro-reading-position{font-size:0.65rem !important;margin:0 0 1.5rem 0 !important;}
.taro-reading-card-image{transform:none !important;scale:1 !important;width:auto !important;height:auto !important;display:block !important;position:relative !important;margin:1.5rem 0 !important;}
.taro-reading-card-image *{transform:none !important;scale:1 !important;}
.taro-reading-card-image img:not(.card-image){width:80px !important;max-width:80px !important;min-width:80px !important;height:auto !important;transform:none !important;scale:1 !important;zoom:1 !important;object-fit:contain !important;display:block !important;margin:0 auto !important;box-sizing:border-box !important;position:relative !important;}
.card-image{width:min(50vw,260px) !important;max-width:260px !important;min-width:unset !important;height:auto !important;max-height:40vh !important;object-fit:contain !important;}
.taro-reading-divider{width:60% !important;margin:2rem auto !important;}
.taro-reading-keyword{font-size:0.95rem !important;margin:1rem 0 !important;}
.taro-reading-text{font-size:0.8rem !important;margin:0 !important;line-height:1.7 !important;padding:0 !important;max-width:95% !important;}
.taro-reading-close-btn{font-size:0.7rem !important;padding:0.5rem 1.5rem !important;margin-top:2rem !important;}
.taro-modal{padding:0.5rem;}
.choosing-modal{padding:0.75rem;}
.custom-reading-modal{padding:1.5rem;}
.modal-header h2{font-size:1.5rem;}
.modal-bottom-buttons{gap:12px;margin-top:12px;}
.modal-back-btn{padding:1.75px 2.25px;font-size:2.5px;min-width:7.25px;}
.taro-option{padding:0.75rem 1.5rem;font-size:1rem;margin:0.5rem auto;}
.control-buttons-left{top:calc(15px + var(--safe-area-inset-top,0));left:calc(15px + var(--safe-area-inset-left,0));}
.sound-toggle-btn-left{position:relative !important;top:auto !important;left:auto !important;padding:16px 20px !important;font-size:32px !important;min-width:80px !important;min-height:80px !important;}
.custom-reading-overlay-button{width:106px;height:67px;margin:0;}
}
@media (max-width:480px){:root{--card-w:clamp(92px,26vw,132px);--cardW:var(--card-w);}
.control-buttons{top:calc(8px + var(--safe-area-inset-top,0)) !important;right:calc(8px + var(--safe-area-inset-right,0)) !important;gap:4px !important;}
.control-buttons-left{top:calc(10px + var(--safe-area-inset-top,0)) !important;left:calc(10px + var(--safe-area-inset-left,0)) !important;}
.sound-toggle-btn-left{position:relative !important;top:auto !important;left:auto !important;padding:8px 12px !important;font-size:24px !important;min-width:56px !important;min-height:56px !important;}
.gallery-button{padding:8px 12px !important;font-size:24px !important;min-width:56px !important;min-height:56px !important;}
.taro-header h1{font-size:1.8rem !important;top:calc(10px + var(--safe-area-inset-top,0)) !important;left:0 !important;right:0 !important;width:100% !important;display:block !important;text-align:center !important;}
.taro-container{padding-top:calc(var(--pad) + 45px + var(--safe-area-inset-top,0)) !important;}
.card-slot{width:var(--card-w) !important;height:var(--card-h) !important;}
.taro-card{width:var(--card-w) !important;height:var(--card-h) !important;}
.taro-table{padding:0.15rem !important;min-height:120px !important;}
.taro-main{min-height:300px !important;justify-content:center !important;}
.taro-table-wrap{transform:translateY(clamp(-6vh, -4vh, -2vh)) !important;}
.taro-table{margin:calc(var(--pad) * 0.05) 0 !important;}
}
@media (max-height:500px) and (orientation:landscape){.control-buttons{top:calc(5px + var(--safe-area-inset-top,0)) !important;}
.taro-header h1{font-size:1.6rem !important;top:calc(8px + var(--safe-area-inset-top,0)) !important;left:0 !important;right:0 !important;width:100% !important;display:block !important;text-align:center !important;}
.taro-container{padding-top:calc(var(--pad) + 35px + var(--safe-area-inset-top,0)) !important;}
.taro-main{justify-content:center !important;}
.taro-table-wrap{transform:translateY(-2vh) !important;}
.taro-table{min-height:100px !important;}
}
[data-debug="1"] *{outline:1px solid rgba(255,0,0,0.3) !important;}
[data-debug="1"] .taro-root{outline:2px solid red !important;}
[data-debug="1"] .taro-container{outline:2px solid orange !important;}
[data-debug="1"] .taro-modal,[data-debug="1"] .taro-reading-overlay{outline:3px solid purple !important;background:rgba(128,0,128,0.1) !important;}
[data-debug="1"] .taro-table{outline:2px solid blue !important;}
[data-debug="1"] .taro-card{outline:1px solid green !important;}
[data-debug="1"] .single-card-option,[data-debug="1"] .three-cards-option{outline:2px solid yellow !important;background:rgba(255,255,0,0.1) !important;}
[data-debug="1"] .taro-button{outline:1px solid cyan !important;}
[data-debug="1"]::after{content:"Viewport:" attr(data-viewport) " | DEBUG MODE";position:fixed;top:10px;right:10px;background:rgba(255,0,0,0.9);color:white;padding:5px 10px;border-radius:4px;font-size:12px;z-index:9999;border:2px solid white;}
.icon-btn{width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(20,40,80,0.35);color:#fff;cursor:pointer;display:grid;place-items:center;}
.icon-btn:active{transform:scale(0.98);}
.gallery-modal{padding:clamp(1rem,3vw,1.5rem);width:95vw;max-width:none;max-height:80vh;}
.gallery-modal h2{font-size:clamp(1.5rem,4vw,2rem);margin-bottom:clamp(1.5rem,4vw,2rem);}
.gallery-content{gap:clamp(2rem,5vw,3rem);}
.gallery-grid{grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:clamp(0.75rem,2vw,1rem) clamp(0.5rem,1.5vw,0.75rem);}
.gallery-card img{height:100%;}
.gallery-card-fallback{height:100%;padding:8px;}
.gallery-card-fallback .gallery-card-name{font-size:clamp(9px,1.8vw,11px);margin-bottom:3px;}
.gallery-card-fallback .gallery-card-keyword{font-size:clamp(7px,1.5vw,9px);}
.gallery-card-info{padding:4px 8px;font-size:clamp(9px,1.8vw,11px);}
.gallery-card-name{font-size:clamp(9px,1.8vw,11px);}
.gallery-section h3{font-size:clamp(1rem,2.5vw,1.3rem);}
.sound-toggle-btn,.gallery-button,.taro-modal{max-height:calc(100dvh - var(--pad) - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0));overflow-y:auto;overflow-x:hidden;}
.taro-reading-overlay{padding:calc(var(--space) + var(--safe-area-inset-top,0)) var(--space) calc(var(--space) + var(--safe-area-inset-bottom,0)) !important;}
.taro-reading-panel{padding:clamp(1rem,4vw,1.5rem) !important;max-height:calc(100dvh - (var(--space) * 2) - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0)) !important;width:min(92vw,600px) !important;margin:0 !important;}
.taro-reading-divider{margin:1rem auto !important;width:30% !important;}
.gallery-modal,.taro-custom-modal{max-height:calc(100dvh - (var(--space) * 2) - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0)) !important;margin:0 !important;overflow-y:auto !important;}
body{overflow-x:hidden !important;}
button,.gallery-card,.card-anim,.taro-deck,.taro-button,.modal-back-btn,.sound-toggle-btn,.gallery-button,.custom-modal-btn,.taro-reading-close-btn,.gallery-close-btn,.custom-reading-overlay-button,.taro-option,.icon-btn{touch-action:manipulation;}
.taro-background{background-attachment:scroll !important;}
.taro-main{min-height:unset !important;}
.choosing-modal{overflow:visible !important;}
.choosing-modal .spread-selection{display:grid !important;grid-template-columns:repeat(2,minmax(0,1fr)) !important;gap:clamp(6px,2vw,12px) !important;margin:calc(var(--pad) * 0.5) 0 !important;justify-items:center !important;align-items:center !important;}
@media (max-width:768px){.choosing-modal .single-card-option,.choosing-modal .three-cards-option{transform:none !important;}
}
.choosing-modal .spread-preview{min-height:calc((var(--card-h) + 14px) * 0.5) !important;display:flex !important;justify-content:center !important;align-items:center !important;margin-bottom:0.5rem !important;}
.choosing-modal .spread-option{opacity:1 !important;visibility:visible !important;display:block !important;}
.taro-table-content .taro-modal.choosing-modal{position:absolute !important;left:50% !important;top:50% !important;transform:translate(-50%,-50%) !important;width:clamp(280px,min(480px,calc(var(--tableW) * 0.85)),90vw) !important;max-width:calc(var(--tableW) * 0.9) !important;aspect-ratio:1 / 0.35 !important;background:rgba(10,18,48,0.1) !important;backdrop-filter:none !important;-webkit-backdrop-filter:none !important;border:none !important;border-radius:16px !important;box-shadow:none !important;padding:0 !important;display:flex !important;flex-direction:column !important;justify-content:center !important;align-items:center !important;margin:0 !important;z-index:100 !important;overflow:visible !important;}
.choosing-modal .spread-selection{display:grid !important;grid-template-columns:repeat(2,1fr) !important;grid-template-rows:auto !important;gap:clamp(8px,2.5vw,16px) !important;width:100% !important;padding:clamp(10px,3vw,16px) clamp(16px,4vw,24px) 0 !important;margin:0 !important;justify-items:center !important;align-items:center !important;}
.choosing-modal .single-card-option,.choosing-modal .three-cards-option{grid-column:auto !important;grid-row:auto !important;transform:none !important;width:100% !important;display:flex !important;justify-content:center !important;align-items:center !important;}
.choosing-modal .preview-card,.choosing-modal .single-preview-card,.choosing-modal .three-preview-card,.choosing-modal .preview-card-inner{width:calc(var(--card-w) - 4px) !important;height:calc(var(--card-h) - 4px) !important;border-radius:8px !important;}
.choosing-modal .preview-card{border:1px solid rgba(255,255,255,0.2) !important;box-shadow:0 4px 16px rgba(0,123,255,0.3),inset 0 1px 0 rgba(255,255,255,0.1) !important;}
.choosing-modal .three-preview-card.left-card{transform:rotate(-10deg) translateX(-18px) !important;}
.choosing-modal .three-preview-card.right-card{transform:rotate(10deg) translateX(18px) !important;}
.choosing-modal .three-preview-card.center-card{z-index:2 !important;}
.choosing-modal .spread-preview{min-height:calc((var(--card-h) + 8px) * 0.5) !important;width:100% !important;display:flex !important;justify-content:center !important;align-items:center !important;position:relative !important;}
.choosing-modal .modal-bottom-buttons{display:flex !important;flex-direction:row !important;justify-content:center !important;align-items:center !important;gap:clamp(12px,4vw,20px) !important;width:100% !important;padding:clamp(8px,2vw,12px) clamp(16px,4vw,24px) clamp(10px,3vw,16px) !important;margin:clamp(-100px,-20vw,-70px) 0 0 0 !important;}
.choosing-modal .modal-back-btn{display:none !important;}
.choosing-modal .modal-back-btn:hover:not(:disabled){background:linear-gradient(135deg,rgba(0,123,255,1),rgba(0,50,150,1)) !important;transform:translateY(-1px) !important;box-shadow:0 6px 16px rgba(0,123,255,0.4) !important;}
.choosing-modal .custom-reading-overlay-button{width:226px !important;height:70px !important;padding:0 !important;border-radius:8px !important;overflow:hidden !important;border:1px solid rgba(255,255,255,0.2) !important;box-shadow:0 4px 12px rgba(0,123,255,0.3) !important;transition:all 0.2s ease !important;}
.choosing-modal .custom-reading-overlay-button img{width:100% !important;height:100% !important;object-fit:cover !important;display:block !important;position:absolute !important;top:0 !important;left:0 !important;border-radius:inherit !important;}
.choosing-modal .custom-reading-overlay-button:hover:not(:disabled){transform:translateY(-1px) !important;box-shadow:0 6px 16px rgba(0,123,255,0.4) !important;}
@media (max-width:768px){.taro-table-content .taro-modal.choosing-modal{position:absolute !important;left:50% !important;top:0% !important;transform:translate(-50%,-100%) !important;width:clamp(280px,min(460px,calc(var(--tableW) * 0.85)),95vw) !important;max-width:calc(var(--tableW) * 0.9) !important;aspect-ratio:1 / 0.375 !important;max-height:none !important;overflow:visible !important;margin:0 !important;}
.choosing-modal .preview-card,.choosing-modal .single-preview-card,.choosing-modal .three-preview-card,.choosing-modal .preview-card-inner{width:calc(var(--card-w) * 1.143) !important;height:calc(var(--card-h) * 1.143) !important;}
.choosing-modal .spread-preview{min-height:calc((var(--card-h) * 1.143 + 8px)) !important;width:100% !important;overflow:visible !important;}
.choosing-modal .custom-reading-overlay-button{width:213px !important;height:67px !important;}
.choosing-modal .modal-back-btn{display:none !important;}
.choosing-modal .modal-bottom-buttons{margin:clamp(-450px,-90vw,-750px) 0 0 0 !important;}
}
@media (max-width:480px){
.choosing-modal .preview-card,.choosing-modal .single-preview-card,.choosing-modal .three-preview-card,.choosing-modal .preview-card-inner{width:clamp(80px,22.86vw,114px) !important;height:calc(clamp(80px,22.86vw,114px) * 1.55) !important;}
.choosing-modal .spread-preview{min-height:calc((clamp(80px,22.86vw,114px) * 1.55 + 8px)) !important;overflow:visible !important;}
.choosing-modal .custom-reading-overlay-button{width:clamp(160px,40vw,183px) !important;height:clamp(50px,12.57vw,57px) !important;max-width:90% !important;padding:0 !important;overflow:hidden !important;}
.choosing-modal .custom-reading-overlay-button img{width:100% !important;height:100% !important;object-fit:cover !important;display:block !important;position:absolute !important;top:0 !important;left:0 !important;border-radius:inherit !important;}
.choosing-modal .modal-bottom-buttons{margin:clamp(-450px,-90vw,-750px) 0 0 0 !important;}
}

/* =========================
   GLASS SYSTEM (GLOBAL)
   ========================= */
:root{
  --glass-bg: rgba(20, 40, 80, 0.22);
  --glass-bg-strong: rgba(10, 18, 48, 0.35);
  --glass-border: rgba(255, 255, 255, 0.16);
  --glass-border-strong: rgba(255, 255, 255, 0.22);
  --glass-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
  --glass-inset: inset 0 1px 0 rgba(255,255,255,0.10), inset 0 -1px 0 rgba(0,0,0,0.18);
  --glass-blur: 18px;
  --glass-sat: 1.15;
}
.glass{
  background: var(--glass-bg) !important;
  border: 1px solid var(--glass-border) !important;
  box-shadow: var(--glass-shadow), var(--glass-inset) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
}
.glass-strong{
  background: var(--glass-bg-strong) !important;
  border-color: var(--glass-border-strong) !important;
  backdrop-filter: blur(calc(var(--glass-blur) + 6px)) saturate(calc(var(--glass-sat) + 0.10)) !important;
  -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 6px)) saturate(calc(var(--glass-sat) + 0.10)) !important;
}
.no-glass{
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* =========================
   APPLY GLASS TO UI ELEMENTS
   ========================= */

/* Buttons / clickable UI */
.gallery-button,
.sound-toggle-btn,
.taro-button,
.custom-modal-btn,
.taro-reading-close-btn,
.gallery-close-btn,
.modal-back-btn,
.custom-reading-overlay-button{
  background: var(--glass-bg) !important;
  border: 1px solid var(--glass-border) !important;
  box-shadow: var(--glass-shadow), var(--glass-inset) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
}

/* Hover polish (keep subtle, do not change layout) */
.gallery-button:hover,
.sound-toggle-btn:hover,
.taro-button:hover,
.custom-modal-btn:hover:not(:disabled),
.taro-reading-close-btn:hover,
.gallery-close-btn:hover,
.custom-reading-overlay-button:hover:not(:disabled){
  background: rgba(255,255,255,0.06) !important;
  border-color: rgba(255,255,255,0.22) !important;
  transform: translateY(-1px);
}

/* Inputs */
.custom-modal-input,
.taro-question-input{
  background: rgba(10, 18, 48, 0.22) !important;
  border: 1px solid rgba(255,255,255,0.14) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.28), var(--glass-inset) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
}
.custom-modal-input:focus,
.taro-question-input:focus{
  border-color: rgba(245,197,66,0.22) !important;
  box-shadow: 0 12px 40px rgba(0,0,0,0.35), 0 0 24px rgba(245,197,66,0.08), var(--glass-inset) !important;
}

/* Modals / panels */
.taro-modal,
.gallery-modal,
.taro-reading-panel{
  background: rgba(10, 18, 48, 0.28) !important;
  border: 1px solid rgba(255,255,255,0.14) !important;
  box-shadow: 0 20px 70px rgba(0,0,0,0.50), var(--glass-inset) !important;
  backdrop-filter: blur(calc(var(--glass-blur) + 8px)) saturate(calc(var(--glass-sat) + 0.12)) !important;
  -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 8px)) saturate(calc(var(--glass-sat) + 0.12)) !important;
}

/* Gallery card container stays glass, image stays unchanged */
.gallery-card{
  background: rgba(20, 30, 60, 0.18) !important;
  border: 1px solid rgba(255,255,255,0.10) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25), var(--glass-inset) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
}
.gallery-card-info{
  background: rgba(10,15,35,0.55) !important;
  border: 1px solid rgba(255,255,255,0.12) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
}

/* =========================
   HARD EXCLUSIONS (ASSETS)
   ========================= */

/* Anything that is an asset-backed surface must not blur */
.taro-background,
.taro-deck-inner,
.taro-card-back,
.preview-card-back,
.custom-reading-underlay-image,
.gallery-card img,
.taro-card-image,
.preview-card-image{
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
/* =========================
   MOBILE FIT PATCH
   ========================= */
@media (max-width:768px){
  .taro-reading-overlay{
    padding:clamp(0.5rem, 2vw, 1rem) !important;
  }
  .taro-reading-panel{
    max-height:calc(100svh - clamp(1rem, 4vw, 2rem) - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0)) !important;
    padding:clamp(1rem, 3vw, 1.5rem) !important;
    min-height:auto !important;
  }
  .taro-ai-title{
    font-size:clamp(1.1rem, 3vw, 1.4rem) !important;
    margin-bottom:clamp(1rem, 3vw, 1.5rem) !important;
  }
  .taro-ai-content{
    font-size:clamp(0.85rem, 2.5vw, 0.95rem) !important;
    line-height:1.7 !important;
  }
  .taro-reading-card-image img,
  .card-image{
    max-width:min(50vw, 200px) !important;
    max-height:30vh !important;
  }
  .taro-table-wrap{
    transform:translateY(clamp(-6vh, -4vh, -2vh)) !important;
  }
}
@media (max-width:420px){
  .control-buttons{
    top:calc(5px + var(--safe-area-inset-top,0)) !important;
    right:calc(5px + var(--safe-area-inset-right,0)) !important;
    gap:4px !important;
  }
  .control-buttons button{
    padding:8px 10px !important;
    font-size:20px !important;
    min-width:40px !important;
    min-height:40px !important;
  }
  .taro-reading-close-btn{
    padding:0.5rem 1.2rem !important;
    font-size:0.7rem !important;
    margin-top:1.5rem !important;
  }
}

/* =========================
   MODE SELECTION + GET READING MOBILE FIX
   ========================= */

/* 1) ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð² - Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÐ¼ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ */
.spread-selection{
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* 2) ÐÐ° Ð¼Ð¾Ð±Ð¸Ð»ÐºÐ°Ñ… - Ð´ÐµÐ»Ð°ÐµÐ¼ Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹ grid, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²ÑÑ‘ Ð²Ð»ÐµÐ·Ð°Ð»Ð¾ */
@media (max-width: 480px){
  .spread-selection{
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 10px !important;
    align-items: stretch !important;
    padding: clamp(12px, 3vw, 20px) !important;
  }
  
  .spread-option{
    min-width: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    transform: none !important;
    padding: 8px !important;
  }
  
  .spread-preview{
    width: 100% !important;
    max-width: 100% !important;
  }
  
  .preview-card,
  .single-preview-card,
  .three-preview-card{
    max-width: 100% !important;
  }
}

/* 3) Ð•ÑÐ»Ð¸ ÑÐºÑ€Ð°Ð½ ÑÐ¾Ð²ÑÐµÐ¼ ÑƒÐ·ÐºÐ¸Ð¹ - 1 ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° */
@media (max-width: 360px){
  .spread-selection{
    grid-template-columns: 1fr !important;
  }
}

/* 4) ÐšÐ½Ð¾Ð¿ÐºÐ° Custom Reading - ÑƒÐ¶Ð¸Ð¼Ð°ÐµÐ¼ Ð½Ð° Ð¼Ð¾Ð±Ð¸Ð»ÐºÐ°Ñ… */
@media (max-width: 480px){
  .custom-reading-button,
  .custom-reading-overlay-button{
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  .choosing-modal .custom-reading-overlay-button{
    width: clamp(140px,35vw,160px) !important;
    max-width: 90% !important;
    height: clamp(44px,11vw,50px) !important;
    min-height: 44px !important;
  }
}

/* 5) Ð¤Ð¸ÐºÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Get Reading: Ð¾Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¾ "Ð½Ðµ Ð²Ð»Ð°Ð·Ð¸Ñ‚" Ð¸Ð·-Ð·Ð° padding/letter-spacing */
.get-reading-container{
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

.get-reading-container button,
.get-reading-container .taro-button{
  width: auto !important;
  max-width: 100% !important;
  min-width: fit-content !important;
  box-sizing: border-box !important;
  font-family: 'Georgia', serif !important;
  font-weight: 300 !important;
  letter-spacing: 0.15em !important;
  padding: clamp(0.4rem, 1.2vw, 0.8rem) clamp(1rem, 2.5vw, 1.8rem) !important;
}

/* ÐÐ° Ð¼Ð¾Ð±Ð¸Ð»ÐºÐµ Ð´ÐµÐ»Ð°ÐµÐ¼ Get Reading ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½ÐµÐµ */
@media (max-width: 480px){
  .get-reading-container{
    margin-top: clamp(-56px, -14vh, -28px) !important;
  }
  .get-reading-container button,
  .get-reading-container .taro-button{
    padding: clamp(0.4rem, 1.2vw, 0.7rem) clamp(0.9rem, 2.2vw, 1.5rem) !important;
    font-size: clamp(0.88rem, 3.6vw, 1.05rem) !important;
    letter-spacing: 0.15em !important;
    white-space: nowrap !important;
    line-height: 1.15 !important;
  }
}

/* 6) Ð•ÑÐ»Ð¸ Ñƒ Get Reading ÐµÑÑ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ "Ñ€Ð°Ð¼ÐºÐ°"/Ð¿ÑÐµÐ²Ð´Ð¾ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ */
.get-reading-container button::before,
.get-reading-container button::after,
.get-reading-container .taro-button::before,
.get-reading-container .taro-button::after{
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* 7) Choosing modal - Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐºÑ€Ð¾Ð»Ð» ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ */
@media (max-width: 480px){
  .choosing-modal{
    overflow-y: auto !important;
    max-height: calc(100svh - var(--safe-area-inset-top,0) - var(--safe-area-inset-bottom,0)) !important;
  }
  
  .choosing-modal .spread-selection{
    min-height: auto !important;
  }
}

/* =========================
   MODE SELECT: NO INNER SCROLL + ALWAYS FIT
   ========================= */

/* 1) Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð±Ð»Ð¾Ðº Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ€Ð°ÑÐºÐ»Ð°Ð´Ð° - Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð²Ñ‹ÑÐ¾Ñ‚Ð° Ð±ÐµÐ· ÑÐºÑ€Ð¾Ð»Ð»Ð° */
.choosing-modal{
  height: calc(var(--vh, 1vh) * 100) !important;
  max-height: calc(var(--vh, 1vh) * 100) !important;
  padding-top: env(safe-area-inset-top, 0) !important;
  padding-bottom: env(safe-area-inset-bottom, 0) !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
  box-sizing: border-box !important;
}

/* 2) Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ - ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐºÑ€Ð¾Ð»Ð», Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ flex */
.choosing-modal .spread-selection{
  flex: 1 !important;
  min-height: 0 !important;
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: clamp(8px, 2.2vw, 16px) !important;
  overflow: hidden !important;
  align-items: center !important;
  justify-items: center !important;
  padding: clamp(6px, 1.8vw, 14px) !important;
  box-sizing: border-box !important;
}

/* 3) ÐžÐ¿Ñ†Ð¸Ð¸ Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð² - ÑƒÐ¶Ð¸Ð¼Ð°ÐµÐ¼ÑÑ */
.spread-option{
  width: 100% !important;
  max-width: 100% !important;
  min-width: 0 !important;
  min-height: 0 !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  transform: none !important;
}

/* 4) Preview ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº - Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸ */
.spread-preview{
  width: 100% !important;
  max-width: clamp(120px, 34vw, 190px) !important;
  aspect-ratio: 1.55 / 1 !important;
  min-height: 0 !important;
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
}

.preview-card,
.single-preview-card,
.three-preview-card{
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important;
  aspect-ratio: 1.55 / 1 !important;
  min-height: 0 !important;
}

.preview-card-image{
  width: 100% !important;
  height: 100% !important;
  object-fit: contain !important;
}

/* 5) ÐšÐ½Ð¾Ð¿ÐºÐ° Custom Reading - ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð° Ð½Ð° 1/3 */
.custom-reading-overlay-button{
  width: min(115vw, 559px) !important;
  transform: scale(1.0) !important;
  transform-origin: center top !important;
  margin: 0 auto !important;
  height: auto !important;
}

.custom-reading-underlay-image{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  border-radius: inherit !important;
}

/* 6) Modal bottom buttons - ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¾ */
.modal-bottom-buttons{
  flex-shrink: 0 !important;
  min-height: 0 !important;
  padding: clamp(8px, 2vw, 12px) !important;
}

/* 7) ÐÐ° Ð½Ð¸Ð·ÐºÐ¸Ñ… ÑÐºÑ€Ð°Ð½Ð°Ñ… ÑƒÐ¶Ð¸Ð¼Ð°ÐµÐ¼ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ */
@media (max-height: 720px){
  .choosing-modal .spread-selection{
    gap: 10px !important;
    padding: clamp(4px, 1.5vw, 10px) !important;
  }
  
  .spread-preview{
    max-width: clamp(110px, 33vw, 170px) !important;
  }
  
  .custom-reading-overlay-button{
    transform: scale(0.80) !important;
  }
}

/* 8) ÐÐ° Ð¾Ñ‡ÐµÐ½ÑŒ ÑƒÐ·ÐºÐ¸Ñ… ÑÐºÑ€Ð°Ð½Ð°Ñ… - 1 ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° */
@media (max-width: 340px){
  .choosing-modal .spread-selection{
    grid-template-columns: 1fr !important;
  }
}

/* 9) Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²ÑÐµ transform Ñƒ Ð¾Ð¿Ñ†Ð¸Ð¹ Ð½Ð° Ð¼Ð¾Ð±Ð¸Ð»ÐºÐ°Ñ… */
@media (max-width: 768px){
  .single-card-option,
  .three-cards-option{
    transform: none !important;
  }
}

/* =========================
   GET READING: TOP BREATHING SPACE + SAFE AREA
   ========================= */

/* 1) ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ - Ð²ÐµÑ€Ñ…Ð½Ð¸Ð¹ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ safe-area */
.taro-reading-panel,
.taro-ai-panel{
  box-sizing: border-box !important;
  padding-top: calc(env(safe-area-inset-top, 0) + clamp(18px, 6vh, 56px)) !important;
  padding-left: clamp(14px, 4vw, 22px) !important;
  padding-right: clamp(14px, 4vw, 22px) !important;
  padding-bottom: calc(env(safe-area-inset-bottom, 0) + clamp(18px, 4vw, 24px)) !important;
}

/* 2) Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ ÑÐºÑ€Ð¾Ð»Ð» Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° */
.taro-reading-panel,
.taro-ai-panel{
  max-height: calc(var(--vh, 1vh) * 100 - env(safe-area-inset-top, 0) - env(safe-area-inset-bottom, 0)) !important;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

/* 3) Ð£Ð»ÑƒÑ‡ÑˆÐ°ÐµÐ¼ Ñ‡Ð¸Ñ‚Ð°Ð±ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ñ‚ÐµÐºÑÑ‚Ð° */
.taro-ai-content p,
.taro-reading-text{
  line-height: 1.55 !important;
  margin-top: 0.7em !important;
  margin-bottom: 0.7em !important;
}

/* 4) Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ñ€Ð¸Ð»Ð¸Ð¿Ð°Ñ‚ÑŒ Ðº Ð²ÐµÑ€Ñ…Ñƒ */
.taro-ai-title,
.taro-reading-position{
  margin-top: 0.2em !important;
  margin-bottom: 0.7em !important;
  line-height: 1.2 !important;
}

/* 5) AI question chip - Ð¾Ñ‚ÑÑ‚ÑƒÐ¿ ÑÐ²ÐµÑ€Ñ…Ñƒ */
.taro-ai-question-chip{
  margin-top: clamp(0.5rem, 2vh, 1rem) !important;
}

/* 6) ÐÐ° Ð¼Ð¾Ð±Ð¸Ð»ÐºÐ°Ñ… ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÐµÐ¼ Ð²ÐµÑ€Ñ…Ð½Ð¸Ð¹ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿ */
@media (max-width: 768px){
  .taro-reading-panel,
  .taro-ai-panel{
    padding-top: calc(env(safe-area-inset-top, 0) + clamp(12px, 4vh, 32px)) !important;
    padding-left: clamp(12px, 3vw, 18px) !important;
    padding-right: clamp(12px, 3vw, 18px) !important;
  }
}

/* 7) ÐÐ° Ð¾Ñ‡ÐµÐ½ÑŒ Ð½Ð¸Ð·ÐºÐ¸Ñ… ÑÐºÑ€Ð°Ð½Ð°Ñ… - ÐµÑ‰Ðµ Ð¼ÐµÐ½ÑŒÑˆÐµ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿ */
@media (max-height: 600px){
  .taro-reading-panel,
  .taro-ai-panel{
    padding-top: calc(env(safe-area-inset-top, 0) + clamp(8px, 2vh, 20px)) !important;
  }
}
    </style>
</body>
</html>
